
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Optim</title>
<meta name="description" content="Documentation of Coq module Optim" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Optim</h1>
<div class="coq">
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.ZArith.html">ZArith</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.micromega.Psatz.html">Psatz</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html">Bool</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html">String</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Program.Equality.html">Program.Equality</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.FSets.FSets.html">FSets</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Wellfounded.Wellfounded.html">Wellfounded</a></span>.<br/>
<span class="kwd">From</span> <span class="id">CDF</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="CDF.Sequences.html">Sequences</a></span> <span class="id"><a href="CDF.IMP.html">IMP</a></span> <span class="id"><a href="CDF.Simulation.html">Simulation</a></span>.<br/>
<br/>
<span class="id">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">string_scope</span>.<br/>
<span class="id">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">Z_scope</span>.<br/>
<span class="id">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">list_scope</span>.<br/>
<br/>
<h1> 3. Optimisations et analyses statiques </h1>
<br/>
<h2> 3.1.  Analyse de vivacité (liveness analysis) </h2>
<br/>
<h3> Ensembles finis d'identificateurs </h3>
<br/>
<div class="doc">L'analyse statique que nous allons étudier travaille sur des
    ensembles finis de variables IMP.  La bibliothèque standard de Coq
    fournit une implémentation efficace des ensembles finis et
    démontre de nombreuses propriétés des opérations ensemblistes.
    Afin d'appliquer cette bibliothèque, nous devons lui fournir un
    module Coq qui décrit le type des éléments (les identificateurs
    d'IMP) et l'égalité entre éléments. </div>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="Ident_Decidable">Ident_Decidable</a></span> &lt;: <span class="id"><a href="https://coq.inria.fr/library/Coq.Structures.DecidableType.html#DecidableType">DecidableType</a></span> <span class="kwd">with</span> <span class="kwd">Definition</span> <span class="id">t</span> := <span class="id"><a href="CDF.IMP.html#ident">ident</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Ident_Decidable.t">t</a></span> := <span class="id"><a href="CDF.IMP.html#ident">ident</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Ident_Decidable.eq">eq</a></span> (<span class="id">x</span> <span class="id">y</span>: <span class="id"><a href="CDF.Optim.html#Ident_Decidable.t">t</a></span>) := <span class="id">x</span> = <span class="id">y</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Ident_Decidable.eq_refl">eq_refl</a></span> := @<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span> <span class="id"><a href="CDF.Optim.html#Ident_Decidable.t">t</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Ident_Decidable.eq_sym">eq_sym</a></span> := @<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_sym">eq_sym</a></span> <span class="id"><a href="CDF.Optim.html#Ident_Decidable.t">t</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Ident_Decidable.eq_trans">eq_trans</a></span> := @<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_trans">eq_trans</a></span> <span class="id"><a href="CDF.Optim.html#Ident_Decidable.t">t</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Ident_Decidable.eq_dec">eq_dec</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span>.<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.Optim.html#Ident_Decidable">Ident_Decidable</a></span>.<br/>
<br/>
<div class="doc">Nous pouvons alors instancier les modules d'ensembles finis
    de la bibliothèque standard Coq sur ce type d'éléments. </div>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="IdentSet">IdentSet</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.FSets.FSetWeakList.html#Make">FSetWeakList.Make</a></span>(<span class="id"><a href="CDF.Optim.html#Ident_Decidable">Ident_Decidable</a></span>).<br/>
<span class="kwd">Module</span> <span class="id"><a name="ISFact">ISFact</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.FSets.FSetFacts.html#WFacts">FSetFacts.WFacts</a></span>(<span class="id"><a href="CDF.Optim.html#IdentSet">IdentSet</a></span>).<br/>
<span class="kwd">Module</span> <span class="id"><a name="ISProp">ISProp</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.FSets.FSetProperties.html#WProperties">FSetProperties.WProperties</a></span>(<span class="id"><a href="CDF.Optim.html#IdentSet">IdentSet</a></span>).<br/>
<span class="kwd">Module</span> <span class="id"><a name="ISDecide">ISDecide</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.FSets.FSetDecide.html#Decide">FSetDecide.Decide</a></span>(<span class="id"><a href="CDF.Optim.html#IdentSet">IdentSet</a></span>).<br/>
<span class="kwd">Import</span> <span class="id"><a href="CDF.Optim.html#ISDecide">ISDecide</a></span>.<br/>
<br/>
<h3> Variables libres </h3>
<br/>
<div class="doc">L'ensemble des variables mentionnées dans une expression. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="fv_aexp">fv_aexp</a></span> (<span class="id">a</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>) : <span class="id"><a href="CDF.Optim.html#t">IdentSet.t</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#CONST">CONST</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="CDF.Optim.html#empty">IdentSet.empty</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> <span class="id">v</span> =&gt; <span class="id"><a href="CDF.Optim.html#singleton">IdentSet.singleton</a></span> <span class="id">v</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#PLUS">PLUS</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id">fv_aexp</span> <span class="id">a1</span>) (<span class="id">fv_aexp</span> <span class="id">a2</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#MINUS">MINUS</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id">fv_aexp</span> <span class="id">a1</span>) (<span class="id">fv_aexp</span> <span class="id">a2</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="fv_bexp">fv_bexp</a></span> (<span class="id">b</span>: <span class="id"><a href="CDF.IMP.html#bexp">bexp</a></span>) : <span class="id"><a href="CDF.Optim.html#t">IdentSet.t</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">b</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#TRUE">TRUE</a></span> =&gt; <span class="id"><a href="CDF.Optim.html#empty">IdentSet.empty</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#FALSE">FALSE</a></span> =&gt; <span class="id"><a href="CDF.Optim.html#empty">IdentSet.empty</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#EQUAL">EQUAL</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id"><a href="CDF.Optim.html#fv_aexp">fv_aexp</a></span> <span class="id">a1</span>) (<span class="id"><a href="CDF.Optim.html#fv_aexp">fv_aexp</a></span> <span class="id">a2</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#LESSEQUAL">LESSEQUAL</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id"><a href="CDF.Optim.html#fv_aexp">fv_aexp</a></span> <span class="id">a1</span>) (<span class="id"><a href="CDF.Optim.html#fv_aexp">fv_aexp</a></span> <span class="id">a2</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#NOT">NOT</a></span> <span class="id">b1</span> =&gt; <span class="id">fv_bexp</span> <span class="id">b1</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#AND">AND</a></span> <span class="id">b1</span> <span class="id">b2</span> =&gt; <span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id">fv_bexp</span> <span class="id">b1</span>) (<span class="id">fv_bexp</span> <span class="id">b2</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">L'ensemble des variables utilisées par une commande. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="fv_com">fv_com</a></span> (<span class="id">c</span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span>) : <span class="id"><a href="CDF.Optim.html#t">IdentSet.t</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span> =&gt; <span class="id"><a href="CDF.Optim.html#empty">IdentSet.empty</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span> =&gt; <span class="id"><a href="CDF.Optim.html#fv_aexp">fv_aexp</a></span> <span class="id">a</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id">fv_com</span> <span class="id">c1</span>) (<span class="id">fv_com</span> <span class="id">c2</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id"><a href="CDF.Optim.html#fv_bexp">fv_bexp</a></span> <span class="id">b</span>) (<span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id">fv_com</span> <span class="id">c1</span>) (<span class="id">fv_com</span> <span class="id">c2</span>))<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span> =&gt; <span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id"><a href="CDF.Optim.html#fv_bexp">fv_bexp</a></span> <span class="id">b</span>) (<span class="id">fv_com</span> <span class="id">c</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<h3> Calcul de post-points fixes </h3>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="FIXPOINT">FIXPOINT</a></span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id"><a name="FIXPOINT.F">F</a></span>: <span class="id"><a href="CDF.Optim.html#t">IdentSet.t</a></span> -&gt; <span class="id"><a href="CDF.Optim.html#t">IdentSet.t</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="FIXPOINT.default">default</a></span>: <span class="id"><a href="CDF.Optim.html#t">IdentSet.t</a></span>.<br/>
<br/>
<div class="doc">Notre but est de calculer un ensemble de variables <span class="bracket"><span class="id">x</span></span> tel que
    <span class="bracket"><span class="id">F</span> <span class="id">x</span></span> est un sous-ensemble de <span class="bracket"><span class="id">x</span></span>.  C'est ce qu'on appelle un
    post-point fixe de <span class="bracket"><span class="id">F</span></span>.
    Nous utilisons un algorithme naïf d'itération bornée:
    on itère <span class="bracket"><span class="id">F</span></span> au plus <span class="bracket"><span class="id">n</span></span> fois à partir de l'ensemble vide,
    en s'arrêtant dès qu'un post-point fixe est atteint.  
    Après <span class="bracket"><span class="id">n</span></span> itérations infructueuse, on renvoie un résultat par défaut. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="iter">iter</a></span> (<span class="id">n</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) (<span class="id">x</span>: <span class="id"><a href="CDF.Optim.html#t">IdentSet.t</a></span>) : <span class="id"><a href="CDF.Optim.html#t">IdentSet.t</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">n</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#O">O</a></span> =&gt; <span class="id"><a href="CDF.Optim.html#FIXPOINT.default">default</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">x</span>' := <span class="id"><a href="CDF.Optim.html#FIXPOINT.F">F</a></span> <span class="id">x</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="CDF.Optim.html#subset">IdentSet.subset</a></span> <span class="id">x</span>' <span class="id">x</span> <span class="kwd">then</span> <span class="id">x</span> <span class="kwd">else</span> <span class="id">iter</span> <span class="id">n</span>' <span class="id">x</span>'<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="niter">niter</a></span> := 10%<span class="id">nat</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="postfixpoint">postfixpoint</a></span> : <span class="id"><a href="CDF.Optim.html#t">IdentSet.t</a></span> := <span class="id"><a href="CDF.Optim.html#iter">iter</a></span> <span class="id"><a href="CDF.Optim.html#niter">niter</a></span> <span class="id"><a href="CDF.Optim.html#empty">IdentSet.empty</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="postfixpoint_charact">postfixpoint_charact</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Optim.html#Subset">IdentSet.Subset</a></span> (<span class="id"><a href="CDF.Optim.html#FIXPOINT.F">F</a></span> <span class="id"><a href="CDF.Optim.html#postfixpoint">postfixpoint</a></span>) <span class="id"><a href="CDF.Optim.html#postfixpoint">postfixpoint</a></span> \/ <span class="id"><a href="CDF.Optim.html#postfixpoint">postfixpoint</a></span> = <span class="id"><a href="CDF.Optim.html#FIXPOINT.default">default</a></span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof1')">Proof.</span></div>
<div class="proofscript" id="proof1">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.Optim.html#postfixpoint">postfixpoint</a></span>. <span class="id">generalize</span> <span class="id"><a href="CDF.Optim.html#niter">niter</a></span>, <span class="id"><a href="CDF.Optim.html#empty">IdentSet.empty</a></span>. <span class="id">induction</span> <span class="id">n</span>; <span class="id">intros</span>; <span class="id">cbn</span>.<br/>
- <span class="id">auto</span>.<br/>
- <span class="id">destruct</span> (<span class="id"><a href="CDF.Optim.html#subset">IdentSet.subset</a></span> (<span class="id"><a href="CDF.Optim.html#FIXPOINT.F">F</a></span> <span class="id">t</span>) <span class="id">t</span>) <span class="id">eqn</span>:<span class="id">SUBSET</span>.<br/>
+ <span class="id">left</span>. <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#subset_2">IdentSet.subset_2</a></span>; <span class="id">auto</span>.<br/>
+ <span class="id">apply</span> <span class="id">IHn</span>. <br/>
Qed.</div>
<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="FIXPOINT.F_stable">F_stable</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="CDF.Optim.html#Subset">IdentSet.Subset</a></span> <span class="id">x</span> <span class="id"><a href="CDF.Optim.html#FIXPOINT.default">default</a></span> -&gt; <span class="id"><a href="CDF.Optim.html#Subset">IdentSet.Subset</a></span> (<span class="id"><a href="CDF.Optim.html#FIXPOINT.F">F</a></span> <span class="id">x</span>) <span class="id"><a href="CDF.Optim.html#FIXPOINT.default">default</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="postfixpoint_upper_bound">postfixpoint_upper_bound</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Optim.html#Subset">IdentSet.Subset</a></span> <span class="id"><a href="CDF.Optim.html#postfixpoint">postfixpoint</a></span> <span class="id"><a href="CDF.Optim.html#FIXPOINT.default">default</a></span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof2')">Proof.</span></div>
<div class="proofscript" id="proof2">
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">REC</span>: <span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span>, <span class="id"><a href="CDF.Optim.html#Subset">IdentSet.Subset</a></span> <span class="id">x</span> <span class="id"><a href="CDF.Optim.html#FIXPOINT.default">default</a></span> -&gt; <span class="id"><a href="CDF.Optim.html#Subset">IdentSet.Subset</a></span> (<span class="id"><a href="CDF.Optim.html#iter">iter</a></span> <span class="id">n</span> <span class="id">x</span>) <span class="id"><a href="CDF.Optim.html#FIXPOINT.default">default</a></span>).<br/>
&nbsp;&nbsp;{ <span class="id">induction</span> <span class="id">n</span>; <span class="id">intros</span>; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;- <span class="id">fsetdec</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> (<span class="id"><a href="CDF.Optim.html#subset">IdentSet.subset</a></span> (<span class="id"><a href="CDF.Optim.html#FIXPOINT.F">F</a></span> <span class="id">x</span>) <span class="id">x</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">REC</span>. <span class="id">fsetdec</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.Optim.html#FIXPOINT">FIXPOINT</a></span>.<br/>
<br/>
<h3> L'analyse de vivacité </h3>
<br/>
<div class="doc"><span class="bracket"><span class="id">L</span></span> est l'ensemble des variables vivantes "après" la commande <span class="bracket"><span class="id">c</span></span>.
    Le résultat de <span class="bracket"><span class="id">live</span> <span class="id">c</span> <span class="id">L</span></span> est l'ensemble des variables vivantes "avant" <span class="bracket"><span class="id">c</span></span>. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="live">live</a></span> (<span class="id">c</span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span>) (<span class="id">L</span>: <span class="id"><a href="CDF.Optim.html#t">IdentSet.t</a></span>) : <span class="id"><a href="CDF.Optim.html#t">IdentSet.t</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span> =&gt; <span class="id">L</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="CDF.Optim.html#mem">IdentSet.mem</a></span> <span class="id">x</span> <span class="id">L</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id"><a href="CDF.Optim.html#remove">IdentSet.remove</a></span> <span class="id">x</span> <span class="id">L</span>) (<span class="id"><a href="CDF.Optim.html#fv_aexp">fv_aexp</a></span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">L</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">live</span> <span class="id">c1</span> (<span class="id">live</span> <span class="id">c2</span> <span class="id">L</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id"><a href="CDF.Optim.html#fv_bexp">fv_bexp</a></span> <span class="id">b</span>) (<span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id">live</span> <span class="id">c1</span> <span class="id">L</span>) (<span class="id">live</span> <span class="id">c2</span> <span class="id">L</span>))<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">L</span>' := <span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id"><a href="CDF.Optim.html#fv_bexp">fv_bexp</a></span> <span class="id">b</span>) <span class="id">L</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">default</span> := <span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id"><a href="CDF.Optim.html#fv_com">fv_com</a></span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>)) <span class="id">L</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Optim.html#postfixpoint">postfixpoint</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> <span class="id">L</span>' (<span class="id">live</span> <span class="id">c</span> <span class="id">x</span>)) <span class="id">default</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Une borne supérieure pour les variables vivantes "avant" est les
    variables vivantes "après" plus toutes les variables utilisées
    dans la commande <span class="bracket"><span class="id">c</span></span>. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="live_upper_bound">live_upper_bound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">L</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Optim.html#Subset">IdentSet.Subset</a></span> (<span class="id"><a href="CDF.Optim.html#live">live</a></span> <span class="id">c</span> <span class="id">L</span>) (<span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id"><a href="CDF.Optim.html#fv_com">fv_com</a></span> <span class="id">c</span>) <span class="id">L</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof3')">Proof.</span></div>
<div class="proofscript" id="proof3">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">c</span>; <span class="id">intros</span>; <span class="id">simpl</span>.<br/>
- <span class="id">fsetdec</span>.<br/>
- <span class="id">destruct</span> (<span class="id"><a href="CDF.Optim.html#mem">IdentSet.mem</a></span> <span class="id">x</span> <span class="id">L</span>) <span class="id">eqn</span>:<span class="id">MEM</span>; <span class="id">fsetdec</span>. <br/>
- <span class="id">specialize</span> (<span class="id">IHc1</span> (<span class="id"><a href="CDF.Optim.html#live">live</a></span> <span class="id">c2</span> <span class="id">L</span>)). <span class="id">specialize</span> (<span class="id">IHc2</span> <span class="id">L</span>). <span class="id">fsetdec</span>.<br/>
- <span class="id">specialize</span> (<span class="id">IHc1</span> <span class="id">L</span>). <span class="id">specialize</span> (<span class="id">IHc2</span> <span class="id">L</span>). <span class="id">fsetdec</span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#postfixpoint_upper_bound">postfixpoint_upper_bound</a></span>. <span class="id">intros</span> <span class="id">x</span>. <span class="id">specialize</span> (<span class="id">IHc</span> <span class="id">x</span>). <span class="id">fsetdec</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Les variables vivantes à l'entrée d'une boucle vérifient 
    les trois conditions suivantes. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="live_while_charact">live_while_charact</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">c</span> <span class="id">L</span>,<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">L</span>' := <span class="id"><a href="CDF.Optim.html#live">live</a></span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>) <span class="id">L</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Optim.html#Subset">IdentSet.Subset</a></span> (<span class="id"><a href="CDF.Optim.html#fv_bexp">fv_bexp</a></span> <span class="id">b</span>) <span class="id">L</span>'<br/>
&nbsp;&nbsp;/\ <span class="id"><a href="CDF.Optim.html#Subset">IdentSet.Subset</a></span> <span class="id">L</span> <span class="id">L</span>'<br/>
&nbsp;&nbsp;/\ <span class="id"><a href="CDF.Optim.html#Subset">IdentSet.Subset</a></span> (<span class="id"><a href="CDF.Optim.html#live">live</a></span> <span class="id">c</span> <span class="id">L</span>') <span class="id">L</span>'.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof4')">Proof.</span></div>
<div class="proofscript" id="proof4">
&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="CDF.Optim.html#postfixpoint_charact">postfixpoint_charact</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> : <span class="id"><a href="CDF.Optim.html#t">IdentSet.t</a></span> =&gt; <span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id"><a href="CDF.Optim.html#fv_bexp">fv_bexp</a></span> <span class="id">b</span>) <span class="id">L</span>) (<span class="id"><a href="CDF.Optim.html#live">live</a></span> <span class="id">c</span> <span class="id">x</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id"><a href="CDF.Optim.html#fv_bexp">fv_bexp</a></span> <span class="id">b</span>) (<span class="id"><a href="CDF.Optim.html#fv_com">fv_com</a></span> <span class="id">c</span>)) <span class="id">L</span>)).<br/>
&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> <span class="id">L</span>'. <span class="id">fold</span> <span class="id">L</span>'. <span class="id">intros</span> [<span class="id">A</span>|<span class="id">A</span>].<br/>
- <span class="id">split</span>. <span class="id">fsetdec</span>. <span class="id">split</span>; <span class="id">fsetdec</span>. <br/>
- <span class="id">rewrite</span> <span class="id">A</span>. <span class="id">split</span>. <span class="id">fsetdec</span>. <span class="id">split</span>. <span class="id">fsetdec</span>. <br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Optim.html#subset_trans">ISProp.subset_trans</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#live_upper_bound">live_upper_bound</a></span>. <span class="id">fsetdec</span>.<br/>
Qed.</div>
<br/>
<h2> 3.2.  Une optimisation: l'élimination de code mort </h2>
<br/>
<h3> La transformation de programme </h3>
<br/>
<div class="doc">L'élimination de code mort, aussi appelée DCE (Dead Code Elimination),
    remplace les affectations <span class="bracket"><span class="id">x</span> := <span class="id">a</span></span> à des variables mortes en
    instructions <span class="bracket"><span class="id">SKIP</span></span>. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="dce">dce</a></span> (<span class="id">c</span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span>) (<span class="id">L</span>: <span class="id"><a href="CDF.Optim.html#t">IdentSet.t</a></span>): <span class="id"><a href="CDF.IMP.html#com">com</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span> =&gt; <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span> =&gt; <span class="kwd">if</span> <span class="id"><a href="CDF.Optim.html#mem">IdentSet.mem</a></span> <span class="id">x</span> <span class="id">L</span> <span class="kwd">then</span> <span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span> <span class="kwd">else</span> <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id"><a href="CDF.IMP.html#SEQ">SEQ</a></span> (<span class="id">dce</span> <span class="id">c1</span> (<span class="id"><a href="CDF.Optim.html#live">live</a></span> <span class="id">c2</span> <span class="id">L</span>)) (<span class="id">dce</span> <span class="id">c2</span> <span class="id">L</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id"><a href="CDF.IMP.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> (<span class="id">dce</span> <span class="id">c1</span> <span class="id">L</span>) (<span class="id">dce</span> <span class="id">c2</span> <span class="id">L</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span> =&gt; <span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> (<span class="id">dce</span> <span class="id">c</span> (<span class="id"><a href="CDF.Optim.html#live">live</a></span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>) <span class="id">L</span>))<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Exemples d'optimisation. </div>
<br/>
<span class="id">Print</span> <span class="id"><a href="CDF.IMP.html#Euclidean_division">Euclidean_division</a></span>.<br/>
<br/>
<span class="kwd">Eval</span> <span class="id">compute</span> <span class="kwd">in</span> (<span class="id"><a href="CDF.Optim.html#dce">dce</a></span> <span class="id"><a href="CDF.IMP.html#Euclidean_division">Euclidean_division</a></span> (<span class="id"><a href="CDF.Optim.html#singleton">IdentSet.singleton</a></span> "<span class="id">r</span>")).<br/>
<br/>
<div class="doc">Effet de la transformation:
<pre>
   r := a;                 ===&gt;   r := a;
   q := 0;                        skip;
   while b &lt;= r do                while b &lt;= r do
     r := r - b;                    r := r - b;
     q := q + 1;                    skip;
   done                           done</pre>
</div>
<br/>
<span class="kwd">Eval</span> <span class="id">compute</span> <span class="kwd">in</span> (<span class="id"><a href="CDF.Optim.html#dce">dce</a></span> <span class="id"><a href="CDF.IMP.html#Euclidean_division">Euclidean_division</a></span> (<span class="id"><a href="CDF.Optim.html#singleton">IdentSet.singleton</a></span> "<span class="id">q</span>")).<br/>
<br/>
<div class="doc">Le programme est inchangé. </div>
<br/>
<h3> Préservation de la sémantique </h3>
<br/>
<div class="doc">Deux états mémoires concordent sur un ensemble <span class="bracket"><span class="id">L</span></span> de variables vivantes
    s'ils associent les mêmes valeurs à chaque variable vivante. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="agree">agree</a></span> (<span class="id">L</span>: <span class="id"><a href="CDF.Optim.html#t">IdentSet.t</a></span>) (<span class="id">s1</span> <span class="id">s2</span>: <span class="id"><a href="CDF.IMP.html#store">store</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="CDF.Optim.html#In">IdentSet.In</a></span> <span class="id">x</span> <span class="id">L</span> -&gt; <span class="id">s1</span> <span class="id">x</span> = <span class="id">s2</span> <span class="id">x</span>.<br/>
<br/>
<div class="doc">Cette définition est monotone par-rapport à l'ensemble <span class="bracket"><span class="id">L</span></span>. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="agree_mon">agree_mon</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">L</span> <span class="id">L</span>' <span class="id">s1</span> <span class="id">s2</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Optim.html#agree">agree</a></span> <span class="id">L</span>' <span class="id">s1</span> <span class="id">s2</span> -&gt; <span class="id"><a href="CDF.Optim.html#Subset">IdentSet.Subset</a></span> <span class="id">L</span> <span class="id">L</span>' -&gt; <span class="id"><a href="CDF.Optim.html#agree">agree</a></span> <span class="id">L</span> <span class="id">s1</span> <span class="id">s2</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof5')">Proof.</span></div>
<div class="proofscript" id="proof5">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.Optim.html#Subset">IdentSet.Subset</a></span>, <span class="id"><a href="CDF.Optim.html#agree">agree</a></span>; <span class="id">intros</span>. <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Si deux états mémoire concordent sur les variables libres d'une
    expression, cette expression s'évalue à la même valeur dans les
    deux états. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="aeval_agree">aeval_agree</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">s1</span> <span class="id">s2</span>, <span class="id"><a href="CDF.Optim.html#agree">agree</a></span> (<span class="id"><a href="CDF.Optim.html#fv_aexp">fv_aexp</a></span> <span class="id">a</span>) <span class="id">s1</span> <span class="id">s2</span> -&gt; <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s1</span> = <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s2</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof6')">Proof.</span></div>
<div class="proofscript" id="proof6">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">a</span>; <span class="id">cbn</span>; <span class="id">intros</span>.<br/>
- <span class="id">auto</span>.<br/>
- <span class="id">apply</span> <span class="id">H</span>. <span class="id">fsetdec</span>. <br/>
- <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHa1</span> | <span class="id">apply</span> <span class="id">IHa2</span>]; <span class="id">eapply</span> <span class="id"><a href="CDF.Optim.html#agree_mon">agree_mon</a></span>; <span class="id">eauto</span>; <span class="id">fsetdec</span>.<br/>
- <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHa1</span> | <span class="id">apply</span> <span class="id">IHa2</span>]; <span class="id">eapply</span> <span class="id"><a href="CDF.Optim.html#agree_mon">agree_mon</a></span>; <span class="id">eauto</span>; <span class="id">fsetdec</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="beval_agree">beval_agree</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">s1</span> <span class="id">s2</span>, <span class="id"><a href="CDF.Optim.html#agree">agree</a></span> (<span class="id"><a href="CDF.Optim.html#fv_bexp">fv_bexp</a></span> <span class="id">b</span>) <span class="id">s1</span> <span class="id">s2</span> -&gt; <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s1</span> = <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s2</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof7')">Proof.</span></div>
<div class="proofscript" id="proof7">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">b</span>; <span class="id">cbn</span>; <span class="id">intros</span>.<br/>
- <span class="id">auto</span>.<br/>
- <span class="id">auto</span>.<br/>
- <span class="id">f_equal</span>; <span class="id">eapply</span> <span class="id"><a href="CDF.Optim.html#aeval_agree">aeval_agree</a></span>; <span class="id">eapply</span> <span class="id"><a href="CDF.Optim.html#agree_mon">agree_mon</a></span>; <span class="id">eauto</span>; <span class="id">fsetdec</span>.<br/>
- <span class="id">f_equal</span>; <span class="id">eapply</span> <span class="id"><a href="CDF.Optim.html#aeval_agree">aeval_agree</a></span>; <span class="id">eapply</span> <span class="id"><a href="CDF.Optim.html#agree_mon">agree_mon</a></span>; <span class="id">eauto</span>; <span class="id">fsetdec</span>.<br/>
- <span class="id">f_equal</span>; <span class="id">apply</span> <span class="id">IHb</span>; <span class="id">auto</span>.<br/>
- <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHb1</span> | <span class="id">apply</span> <span class="id">IHb2</span>]; <span class="id">eapply</span> <span class="id"><a href="CDF.Optim.html#agree_mon">agree_mon</a></span>; <span class="id">eauto</span>; <span class="id">fsetdec</span>.<br/>
Qed.</div>
<br/>
<div class="doc">La relation <span class="bracket"><span class="id">agree</span></span> est préservée par affectation parallèle 
    à une variable vivante (la même valeur est affectée à la variable
    dans les deux états). </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="agree_update_live">agree_update_live</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">L</span> <span class="id">x</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Optim.html#agree">agree</a></span> (<span class="id"><a href="CDF.Optim.html#remove">IdentSet.remove</a></span> <span class="id">x</span> <span class="id">L</span>) <span class="id">s1</span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Optim.html#agree">agree</a></span> <span class="id">L</span> (<span class="id"><a href="CDF.IMP.html#update">update</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">s1</span>) (<span class="id"><a href="CDF.IMP.html#update">update</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">s2</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof8')">Proof.</span></div>
<div class="proofscript" id="proof8">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.Optim.html#agree">agree</a></span>, <span class="id"><a href="CDF.IMP.html#update">update</a></span>; <span class="id">intros</span>. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x</span> <span class="id">x0</span>).<br/>
- <span class="id">auto</span>.<br/>
- <span class="id">apply</span> <span class="id">H</span>. <span class="id">fsetdec</span>.<br/>
Qed.</div>
<br/>
<div class="doc">La relation <span class="bracket"><span class="id">agree</span></span> est préservée par affectation d'un seul côté
    à une variable morte. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="agree_update_dead">agree_update_dead</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">L</span> <span class="id">x</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Optim.html#agree">agree</a></span> <span class="id">L</span> <span class="id">s1</span> <span class="id">s2</span> -&gt; ~<span class="id"><a href="CDF.Optim.html#In">IdentSet.In</a></span> <span class="id">x</span> <span class="id">L</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Optim.html#agree">agree</a></span> <span class="id">L</span> (<span class="id"><a href="CDF.IMP.html#update">update</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">s1</span>) <span class="id">s2</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof9')">Proof.</span></div>
<div class="proofscript" id="proof9">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.Optim.html#agree">agree</a></span>, <span class="id"><a href="CDF.IMP.html#update">update</a></span>; <span class="id">intros</span>. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x</span> <span class="id">x0</span>).<br/>
- <span class="id">subst</span> <span class="id">x0</span>. <span class="id">contradiction</span>.<br/>
- <span class="id">apply</span> <span class="id">H</span>. <span class="id">fsetdec</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Nous démontrons maintenant que l'élimination de code mort préserve
    la sémantique des programmes qui terminent.  Nous utilisons la
    sémantique naturelle d'IMP pour montrer le diagramme suivant:
<pre>
               agree (live c L) s s1
     c / s ----------------------------- dce C L / s1
       |                                         |
       |                                         |
       |                                         |
       v                                         v
      s' -------------------------------------- s1'
                    agree L s' s1'</pre>
  La démonstration est une récurrence sur la dérivation de l'exécution de <span class="bracket"><span class="id">c</span></span>.
</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="dce_correct_terminating">dce_correct_terminating</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>', <span class="id"><a href="CDF.IMP.html#cexec">cexec</a></span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">L</span> <span class="id">s1</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Optim.html#agree">agree</a></span> (<span class="id"><a href="CDF.Optim.html#live">live</a></span> <span class="id">c</span> <span class="id">L</span>) <span class="id">s</span> <span class="id">s1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">s1</span>', <span class="id"><a href="CDF.IMP.html#cexec">cexec</a></span> <span class="id">s1</span> (<span class="id"><a href="CDF.Optim.html#dce">dce</a></span> <span class="id">c</span> <span class="id">L</span>) <span class="id">s1</span>' /\ <span class="id"><a href="CDF.Optim.html#agree">agree</a></span> <span class="id">L</span> <span class="id">s</span>' <span class="id">s1</span>'.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof10')">Proof.</span></div>
<div class="proofscript" id="proof10">
&nbsp;&nbsp;<span class="id">induction</span> 1; <span class="id">intros</span> <span class="id">L</span> <span class="id">s1</span> <span class="id">AG</span>.<br/>
- <span class="comment">(*&nbsp;SKIP&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">s1</span>; <span class="id">split</span>. <span class="id">constructor</span>. <span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;ASSIGN&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> *. <span class="id">destruct</span> (<span class="id"><a href="CDF.Optim.html#mem">IdentSet.mem</a></span> <span class="id">x</span> <span class="id">L</span>) <span class="id">eqn</span>:<span class="id">is_live</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;x&nbsp;est&nbsp;vivante&nbsp;après&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">EVAL</span>: <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s</span> = <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s1</span>) <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="CDF.Optim.html#aeval_agree">aeval_agree</a></span>; <span class="id">eapply</span> <span class="id"><a href="CDF.Optim.html#agree_mon">agree_mon</a></span>; <span class="id">eauto</span>; <span class="id">fsetdec</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#cexec_assign">cexec_assign</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">EVAL</span>. <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#agree_update_live">agree_update_live</a></span>. <span class="id">eapply</span> <span class="id"><a href="CDF.Optim.html#agree_mon">agree_mon</a></span>; <span class="id">eauto</span>. <span class="id">fsetdec</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;x&nbsp;est&nbsp;morte&nbsp;après&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#cexec_skip">cexec_skip</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#agree_update_dead">agree_update_dead</a></span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span>; <span class="id">intros</span>. <span class="id">assert</span> (<span class="id"><a href="CDF.Optim.html#mem">IdentSet.mem</a></span> <span class="id">x</span> <span class="id">L</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>) <span class="kwd">by</span> (<span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#mem_1">IdentSet.mem_1</a></span>; <span class="id">auto</span>). <span class="id">congruence</span>.<br/>
- <span class="comment">(*&nbsp;SEQ&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">IHcexec1</span> <span class="id">_</span> <span class="id">_</span> <span class="id">AG</span>) <span class="kwd">as</span> (<span class="id">s1</span>' &amp; <span class="id">EXEC1</span> &amp; <span class="id">AG1</span>).<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">IHcexec2</span> <span class="id">_</span> <span class="id">_</span> <span class="id">AG1</span>) <span class="kwd">as</span> (<span class="id">s2</span>' &amp; <span class="id">EXEC2</span> &amp; <span class="id">AG2</span>).<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">s2</span>'; <span class="id">split</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#cexec_seq">cexec_seq</a></span> <span class="kwd">with</span> <span class="id">s1</span>'; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;IFTHENELSE&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">EVAL</span>: <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s1</span>) <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="CDF.Optim.html#beval_agree">beval_agree</a></span>; <span class="id">eapply</span> <span class="id"><a href="CDF.Optim.html#agree_mon">agree_mon</a></span>; <span class="id">eauto</span>; <span class="id">fsetdec</span>).<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">IHcexec</span> <span class="id">L</span> <span class="id">s1</span>) <span class="kwd">as</span> (<span class="id">s1</span>' &amp; <span class="id">EXEC</span>' &amp; <span class="id">AG</span>').<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Optim.html#agree_mon">agree_mon</a></span>; <span class="id">eauto</span>. <span class="id">destruct</span> (<span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span>); <span class="id">fsetdec</span>.<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">s1</span>'; <span class="id">split</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#cexec_ifthenelse">cexec_ifthenelse</a></span>. <span class="id">rewrite</span> &lt;- <span class="id">EVAL</span>. <span class="id">destruct</span> (<span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;WHILE&nbsp;done&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="CDF.Optim.html#dce">dce</a></span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>) <span class="id">L</span>) <span class="kwd">with</span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> (<span class="id"><a href="CDF.Optim.html#dce">dce</a></span> <span class="id">c</span> (<span class="id"><a href="CDF.Optim.html#live">live</a></span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>) <span class="id">L</span>))).<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.Optim.html#live_while_charact">live_while_charact</a></span> <span class="id">b</span> <span class="id">c</span> <span class="id">L</span>) <span class="kwd">as</span> (<span class="id">P</span> &amp; <span class="id">Q</span> &amp; <span class="id">R</span>).<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">EVAL</span>: <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s1</span>) <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="CDF.Optim.html#beval_agree">beval_agree</a></span>; <span class="id">eapply</span> <span class="id"><a href="CDF.Optim.html#agree_mon">agree_mon</a></span>; <span class="id">eauto</span>; <span class="id">fsetdec</span>).<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">s1</span>; <span class="id">split</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#cexec_while_done">cexec_while_done</a></span>. <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Optim.html#agree_mon">agree_mon</a></span>; <span class="id">eauto</span>.<br/>
- <span class="comment">(*&nbsp;WHILE&nbsp;loop&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="CDF.Optim.html#dce">dce</a></span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>) <span class="id">L</span>) <span class="kwd">with</span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> (<span class="id"><a href="CDF.Optim.html#dce">dce</a></span> <span class="id">c</span> (<span class="id"><a href="CDF.Optim.html#live">live</a></span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>) <span class="id">L</span>))).<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.Optim.html#live_while_charact">live_while_charact</a></span> <span class="id">b</span> <span class="id">c</span> <span class="id">L</span>) <span class="kwd">as</span> (<span class="id">P</span> &amp; <span class="id">Q</span> &amp; <span class="id">R</span>).<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">EVAL</span>: <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s1</span>) <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="CDF.Optim.html#beval_agree">beval_agree</a></span>; <span class="id">eapply</span> <span class="id"><a href="CDF.Optim.html#agree_mon">agree_mon</a></span>; <span class="id">eauto</span>; <span class="id">fsetdec</span>).<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">IHcexec1</span> (<span class="id"><a href="CDF.Optim.html#live">live</a></span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>) <span class="id">L</span>) <span class="id">s1</span>) <span class="kwd">as</span> (<span class="id">s1</span>' &amp; <span class="id">EXEC1</span> &amp; <span class="id">AG1</span>).<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Optim.html#agree_mon">agree_mon</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">IHcexec2</span> <span class="id">L</span> <span class="id">s1</span>') <span class="kwd">as</span> (<span class="id">s2</span>' &amp; <span class="id">EXEC2</span> &amp; <span class="id">AG2</span>).<br/>
&nbsp;&nbsp;<span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">s2</span>'; <span class="id">split</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#cexec_while_loop">cexec_while_loop</a></span> <span class="kwd">with</span> <span class="id">s1</span>'; <span class="id">auto</span>. <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;<span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<h3> Exercice (3 étoiles) </h3>
<br/>
<div class="doc">On peut montrer la préservation sémantique pour tous les
    programmes, qu'ils terminent ou non, avec un diagramme de
    simulation utilisant la sémantique à réductions d'IMP.
    Complétez la démonstration du diagramme ci-dessous. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="measure">measure</a></span> (<span class="id">c</span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span> =&gt; 1<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id">measure</span> <span class="id">c1</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; 0<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="dce_simulation">dce_simulation</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">s</span> <span class="id">c</span>' <span class="id">s</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#red">red</a></span> (<span class="id">c</span>, <span class="id">s</span>) (<span class="id">c</span>', <span class="id">s</span>') -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">L</span> <span class="id">s1</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Optim.html#agree">agree</a></span> (<span class="id"><a href="CDF.Optim.html#live">live</a></span> <span class="id">c</span> <span class="id">L</span>) <span class="id">s</span> <span class="id">s1</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">exists</span> <span class="id">s1</span>', <span class="id"><a href="CDF.IMP.html#red">red</a></span> (<span class="id"><a href="CDF.Optim.html#dce">dce</a></span> <span class="id">c</span> <span class="id">L</span>, <span class="id">s1</span>) (<span class="id"><a href="CDF.Optim.html#dce">dce</a></span> <span class="id">c</span>' <span class="id">L</span>, <span class="id">s1</span>') /\ <span class="id"><a href="CDF.Optim.html#agree">agree</a></span> (<span class="id"><a href="CDF.Optim.html#live">live</a></span> <span class="id">c</span>' <span class="id">L</span>) <span class="id">s</span>' <span class="id">s1</span>')<br/>
&nbsp;&nbsp;\/<br/>
&nbsp;&nbsp;((<span class="id"><a href="CDF.Optim.html#measure">measure</a></span> <span class="id">c</span>' &lt; <span class="id"><a href="CDF.Optim.html#measure">measure</a></span> <span class="id">c</span>)%<span class="id">nat</span> /\ <span class="id"><a href="CDF.Optim.html#dce">dce</a></span> <span class="id">c</span> <span class="id">L</span> = <span class="id"><a href="CDF.Optim.html#dce">dce</a></span> <span class="id">c</span>' <span class="id">L</span> /\ <span class="id"><a href="CDF.Optim.html#agree">agree</a></span> (<span class="id"><a href="CDF.Optim.html#live">live</a></span> <span class="id">c</span>' <span class="id">L</span>) <span class="id">s</span>' <span class="id">s1</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof11')">Proof.</span></div>
<div class="proofscript" id="proof11">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">until</span> <span class="id">s</span>'; <span class="id">intros</span> <span class="id">STEP</span>. <span class="id">dependent</span> <span class="id">induction</span> <span class="id">STEP</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;A&nbsp;COMPLETER&nbsp;*)</span><br/>
Abort.</div>
<br/>
<br/>
<h2> 3.3. L'allocation de registres </h2>
<br/>
<div class="doc">Dans un "vrai" compilateur, la phase d'allocation de registres
    consiste à placer les variables du programme les plus utilisées
    dans des registres du processeur (disponibles en petit nombre), les
    autres variables étant stockées dans la mémoire, dans des
    emplacements de pile. </div>
<br/>
<div class="doc">Pour étudier l'allocation de registres au niveau du langage IMP,
    nous allons la voir comme un renommage des variables du programme
    IMP qui vise à réduire le nombre de variables différentes
    utilisées.  En effet, le renommage n'est pas nécessairement
    injectif: deux variables qui ne sont jamais utilisées en même temps
    peuvent être fusionnées. </div>
<br/>
<div class="doc">Calculer un bon renommage est un problème algorithmiquement
    difficile, équivalent au coloriage d'un graphe.  Nous allons
    supposer qu'une heuristique extérieure nous donne un renommage,
    appelé <span class="bracket"><span class="id">f</span></span> ci-dessous, et donner des conditions suffisantes et
    facilement vérifiables pour que le <span class="bracket"><span class="id">f</span></span> soit correct et préserve la
    sémantique. </div>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="RENAMING">RENAMING</a></span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id"><a name="RENAMING.f">f</a></span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span> -&gt; <span class="id"><a href="CDF.IMP.html#ident">ident</a></span>.   <span class="docright">(* le renommage proposé  *)</span><br/>
<br/>
<h3> Renommage des variables dans une expression </h3>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="rename_aexp">rename_aexp</a></span> (<span class="id">a</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>) : <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#CONST">CONST</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="CDF.IMP.html#CONST">CONST</a></span> <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> <span class="id">x</span> =&gt; <span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#PLUS">PLUS</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id"><a href="CDF.IMP.html#PLUS">PLUS</a></span> (<span class="id">rename_aexp</span> <span class="id">a1</span>) (<span class="id">rename_aexp</span> <span class="id">a2</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#MINUS">MINUS</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id"><a href="CDF.IMP.html#MINUS">MINUS</a></span> (<span class="id">rename_aexp</span> <span class="id">a1</span>) (<span class="id">rename_aexp</span> <span class="id">a2</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="rename_bexp">rename_bexp</a></span> (<span class="id">b</span>: <span class="id"><a href="CDF.IMP.html#bexp">bexp</a></span>) : <span class="id"><a href="CDF.IMP.html#bexp">bexp</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">b</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#TRUE">TRUE</a></span> =&gt; <span class="id"><a href="CDF.IMP.html#TRUE">TRUE</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#FALSE">FALSE</a></span> =&gt; <span class="id"><a href="CDF.IMP.html#FALSE">FALSE</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#EQUAL">EQUAL</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id"><a href="CDF.IMP.html#EQUAL">EQUAL</a></span> (<span class="id"><a href="CDF.Optim.html#rename_aexp">rename_aexp</a></span> <span class="id">a1</span>) (<span class="id"><a href="CDF.Optim.html#rename_aexp">rename_aexp</a></span> <span class="id">a2</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#LESSEQUAL">LESSEQUAL</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id"><a href="CDF.IMP.html#LESSEQUAL">LESSEQUAL</a></span> (<span class="id"><a href="CDF.Optim.html#rename_aexp">rename_aexp</a></span> <span class="id">a1</span>) (<span class="id"><a href="CDF.Optim.html#rename_aexp">rename_aexp</a></span> <span class="id">a2</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#NOT">NOT</a></span> <span class="id">b1</span> =&gt; <span class="id"><a href="CDF.IMP.html#NOT">NOT</a></span> (<span class="id">rename_bexp</span> <span class="id">b1</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#AND">AND</a></span> <span class="id">b1</span> <span class="id">b2</span> =&gt; <span class="id"><a href="CDF.IMP.html#AND">AND</a></span> (<span class="id">rename_bexp</span> <span class="id">b1</span>) (<span class="id">rename_bexp</span> <span class="id">b2</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<h3> Reconnaissance des expressions qui sont des variables </h3>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="expr_is_var">expr_is_var</a></span> (<span class="id">a</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>): <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CDF.IMP.html#ident">ident</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">a</span> <span class="kwd">with</span> <span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> <span class="id">x</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span> | <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="expr_is_var_correct">expr_is_var_correct</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">x</span>, <span class="id"><a href="CDF.Optim.html#expr_is_var">expr_is_var</a></span> <span class="id">a</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span> -&gt; <span class="id">a</span> = <span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> <span class="id">x</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof12')">Proof.</span></div>
<div class="proofscript" id="proof12">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.Optim.html#expr_is_var">expr_is_var</a></span>; <span class="id">intros</span>. <span class="id">destruct</span> <span class="id">a</span>; <span class="id">congruence</span>.<br/>
Qed.</div>
<br/>
<h3> Transformation des commandes </h3>
<br/>
<div class="doc">La transformation renomme les variables comme prescrit par <span class="bracket"><span class="id">f</span></span>.
    De plus, elle élimine le code mort comme précédemment, ainsi que
    les affectations <span class="bracket"><span class="id">x</span> := <span class="id">y</span></span> si les variables <span class="bracket"><span class="id">x</span></span> et <span class="bracket"><span class="id">y</span></span> sont renommées
    en la même variable <span class="bracket"><span class="id">z</span></span>. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="regalloc">regalloc</a></span> (<span class="id">c</span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span>) (<span class="id">L</span>: <span class="id"><a href="CDF.Optim.html#t">IdentSet.t</a></span>) : <span class="id"><a href="CDF.IMP.html#com">com</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span> =&gt; <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="CDF.Optim.html#mem">IdentSet.mem</a></span> <span class="id">x</span> <span class="id">L</span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="CDF.Optim.html#expr_is_var">expr_is_var</a></span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x</span>) (<span class="id"><a href="CDF.Optim.html#rename_aexp">rename_aexp</a></span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span> =&gt; <span class="kwd">if</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x</span>) (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">y</span>) <span class="kwd">then</span> <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span> <span class="kwd">else</span> <span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x</span>) (<span class="id"><a href="CDF.Optim.html#rename_aexp">rename_aexp</a></span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#SEQ">SEQ</a></span> (<span class="id">regalloc</span> <span class="id">c1</span> (<span class="id"><a href="CDF.Optim.html#live">live</a></span> <span class="id">c2</span> <span class="id">L</span>)) (<span class="id">regalloc</span> <span class="id">c2</span> <span class="id">L</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#IFTHENELSE">IFTHENELSE</a></span> (<span class="id"><a href="CDF.Optim.html#rename_bexp">rename_bexp</a></span> <span class="id">b</span>) (<span class="id">regalloc</span> <span class="id">c1</span> <span class="id">L</span>) (<span class="id">regalloc</span> <span class="id">c2</span> <span class="id">L</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> (<span class="id"><a href="CDF.Optim.html#rename_bexp">rename_bexp</a></span> <span class="id">b</span>) (<span class="id">regalloc</span> <span class="id">c</span> (<span class="id"><a href="CDF.Optim.html#live">live</a></span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>) <span class="id">L</span>))<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<h3> Relation entre les états mémoire </h3>
<br/>
<div class="doc">Nous adaptons la relation <span class="bracket"><span class="id">agree</span></span> entre deux états mémoire,
    précédemment utilisée pour raisonner sur la transformation <span class="bracket"><span class="id">dce</span></span>.
    Maintenant, deux états mémoires <span class="bracket"><span class="id">s1</span></span> et <span class="bracket"><span class="id">s2</span></span> sont reliés vis-à-vis
    des variables vivantes <span class="bracket"><span class="id">L</span></span> si pour toute variable <span class="bracket"><span class="id">x</span></span> vivante,
    les valeurs de <span class="bracket"><span class="id">x</span></span> dans <span class="bracket"><span class="id">s1</span></span> et de <span class="bracket"><span class="id">f</span> <span class="id">x</span></span> dans <span class="bracket"><span class="id">s2</span></span> coincident. </div>
<br/>
<span class="kwd">Definition</span> <span class="id">agree</span>' (<span class="id">L</span>: <span class="id"><a href="CDF.Optim.html#t">IdentSet.t</a></span>) (<span class="id">s1</span> <span class="id">s2</span>: <span class="id"><a href="CDF.IMP.html#store">store</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="CDF.Optim.html#In">IdentSet.In</a></span> <span class="id">x</span> <span class="id">L</span> -&gt; <span class="id">s1</span> <span class="id">x</span> = <span class="id">s2</span> (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x</span>).<br/>
<br/>
<div class="doc">Cette définition est monotone par-rapport à l'ensemble <span class="bracket"><span class="id">L</span></span>. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id">agree</span>'<span class="id">_mon</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">L</span> <span class="id">L</span>' <span class="id">s1</span> <span class="id">s2</span>,<br/>
&nbsp;&nbsp;<span class="id">agree</span>' <span class="id">L</span>' <span class="id">s1</span> <span class="id">s2</span> -&gt; <span class="id"><a href="CDF.Optim.html#Subset">IdentSet.Subset</a></span> <span class="id">L</span> <span class="id">L</span>' -&gt; <span class="id">agree</span>' <span class="id">L</span> <span class="id">s1</span> <span class="id">s2</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof13')">Proof.</span></div>
<div class="proofscript" id="proof13">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.Optim.html#Subset">IdentSet.Subset</a></span>, <span class="id">agree</span>'; <span class="id">intros</span>. <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Si deux états mémoire sont reliés sur les variables libres d'une
    expression, cette expression et son renommage s'évaluent à la même
    valeur dans les deux états. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id">aeval_agree</span>':<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">s1</span> <span class="id">s2</span>, <span class="id">agree</span>' (<span class="id"><a href="CDF.Optim.html#fv_aexp">fv_aexp</a></span> <span class="id">a</span>) <span class="id">s1</span> <span class="id">s2</span> -&gt; <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s1</span> = <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> (<span class="id"><a href="CDF.Optim.html#rename_aexp">rename_aexp</a></span> <span class="id">a</span>) <span class="id">s2</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof14')">Proof.</span></div>
<div class="proofscript" id="proof14">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">a</span>; <span class="id">cbn</span>; <span class="id">intros</span>.<br/>
- <span class="id">auto</span>.<br/>
- <span class="id">apply</span> <span class="id">H</span>. <span class="id">fsetdec</span>. <br/>
- <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHa1</span> | <span class="id">apply</span> <span class="id">IHa2</span>]; <span class="id">eapply</span> <span class="id">agree</span>'<span class="id">_mon</span>; <span class="id">eauto</span>; <span class="id">fsetdec</span>.<br/>
- <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHa1</span> | <span class="id">apply</span> <span class="id">IHa2</span>]; <span class="id">eapply</span> <span class="id">agree</span>'<span class="id">_mon</span>; <span class="id">eauto</span>; <span class="id">fsetdec</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">beval_agree</span>':<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">s1</span> <span class="id">s2</span>, <span class="id">agree</span>' (<span class="id"><a href="CDF.Optim.html#fv_bexp">fv_bexp</a></span> <span class="id">b</span>) <span class="id">s1</span> <span class="id">s2</span> -&gt; <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s1</span> = <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> (<span class="id"><a href="CDF.Optim.html#rename_bexp">rename_bexp</a></span> <span class="id">b</span>) <span class="id">s2</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof15')">Proof.</span></div>
<div class="proofscript" id="proof15">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">b</span>; <span class="id">cbn</span>; <span class="id">intros</span>.<br/>
- <span class="id">auto</span>.<br/>
- <span class="id">auto</span>.<br/>
- <span class="id">f_equal</span>; <span class="id">eapply</span> <span class="id">aeval_agree</span>'; <span class="id">eapply</span> <span class="id">agree</span>'<span class="id">_mon</span>; <span class="id">eauto</span>; <span class="id">fsetdec</span>.<br/>
- <span class="id">f_equal</span>; <span class="id">eapply</span> <span class="id">aeval_agree</span>'; <span class="id">eapply</span> <span class="id">agree</span>'<span class="id">_mon</span>; <span class="id">eauto</span>; <span class="id">fsetdec</span>.<br/>
- <span class="id">f_equal</span>; <span class="id">apply</span> <span class="id">IHb</span>; <span class="id">auto</span>.<br/>
- <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHb1</span> | <span class="id">apply</span> <span class="id">IHb2</span>]; <span class="id">eapply</span> <span class="id">agree</span>'<span class="id">_mon</span>; <span class="id">eauto</span>; <span class="id">fsetdec</span>.<br/>
Qed.</div>
<br/>
<div class="doc">La relation <span class="bracket"><span class="id">agree</span>'</span> est préservée par affectation unilatérale
    à une variable morte. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id">agree</span>'<span class="id">_update_dead</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">L</span> <span class="id">x</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id">agree</span>' <span class="id">L</span> <span class="id">s1</span> <span class="id">s2</span> -&gt; ~<span class="id"><a href="CDF.Optim.html#In">IdentSet.In</a></span> <span class="id">x</span> <span class="id">L</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">agree</span>' <span class="id">L</span> (<span class="id"><a href="CDF.IMP.html#update">update</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">s1</span>) <span class="id">s2</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof16')">Proof.</span></div>
<div class="proofscript" id="proof16">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">agree</span>', <span class="id"><a href="CDF.IMP.html#update">update</a></span>; <span class="id">intros</span>. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x</span> <span class="id">x0</span>).<br/>
- <span class="id">subst</span> <span class="id">x0</span>. <span class="id">contradiction</span>.<br/>
- <span class="id">apply</span> <span class="id">H</span>. <span class="id">fsetdec</span>.<br/>
Qed.</div>
<br/>
<div class="doc">La relation <span class="bracket"><span class="id">agree</span>'</span> est préservée par affectation de la même
    valeur à une variable vivante <span class="bracket"><span class="id">x</span></span> et à son renommage <span class="bracket"><span class="id">f</span> <span class="id">x</span></span>, pourvu
    qu'aucune des autres variables vivantes <span class="bracket"><span class="id">z</span></span> ne soit renommée à <span class="bracket"><span class="id">f</span> <span class="id">x</span></span>.
    C'est une propriété de non-interférence que le renommage <span class="bracket"><span class="id">f</span></span> doit
    satisfaire. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id">agree</span>'<span class="id">_update_live</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">L</span> <span class="id">x</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id">agree</span>' (<span class="id"><a href="CDF.Optim.html#remove">IdentSet.remove</a></span> <span class="id">x</span> <span class="id">L</span>) <span class="id">s1</span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">z</span>, <span class="id"><a href="CDF.Optim.html#In">IdentSet.In</a></span> <span class="id">z</span> <span class="id">L</span> -&gt; <span class="id">z</span> &lt;&gt; <span class="id">x</span> -&gt; <span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">z</span> &lt;&gt; <span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">agree</span>' <span class="id">L</span> (<span class="id"><a href="CDF.IMP.html#update">update</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">s1</span>) (<span class="id"><a href="CDF.IMP.html#update">update</a></span> (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x</span>) <span class="id">v</span> <span class="id">s2</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof17')">Proof.</span></div>
<div class="proofscript" id="proof17">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">agree</span>', <span class="id"><a href="CDF.IMP.html#update">update</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x</span> <span class="id">x0</span>); <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x</span>) (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x0</span>)).<br/>
- <span class="id">auto</span>.<br/>
- <span class="id">congruence</span>.<br/>
- <span class="id">exfalso</span>. <span class="id">apply</span> (<span class="id">H0</span> <span class="id">x0</span>); <span class="id">auto</span>.<br/>
- <span class="id">apply</span> <span class="id">H</span>. <span class="id">fsetdec</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Un cas particulier du lemme <span class="bracket"><span class="id">agree</span>'<span class="id">_update_live</span></span>, lorsque la
    valeur affectée à <span class="bracket"><span class="id">x</span></span> et <span class="bracket"><span class="id">f</span> <span class="id">x</span></span> est la valeur d'une autre variable <span class="bracket"><span class="id">y</span></span>.
    Dans ce cas, comme observé par Chaitin, l'hypothèse de
    non-interférence peut être affaiblie. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id">agree</span>'<span class="id">_update_move</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">L</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">agree</span>' (<span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id"><a href="CDF.Optim.html#remove">IdentSet.remove</a></span> <span class="id">x</span> <span class="id">L</span>) (<span class="id"><a href="CDF.Optim.html#singleton">IdentSet.singleton</a></span> <span class="id">y</span>)) <span class="id">s1</span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">z</span>, <span class="id"><a href="CDF.Optim.html#In">IdentSet.In</a></span> <span class="id">z</span> <span class="id">L</span> -&gt; <span class="id">z</span> &lt;&gt; <span class="id">x</span> -&gt; <span class="id">z</span> &lt;&gt; <span class="id">y</span> -&gt; <span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">z</span> &lt;&gt; <span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">agree</span>' <span class="id">L</span> (<span class="id"><a href="CDF.IMP.html#update">update</a></span> <span class="id">x</span> (<span class="id">s1</span> <span class="id">y</span>) <span class="id">s1</span>) (<span class="id"><a href="CDF.IMP.html#update">update</a></span> (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x</span>) (<span class="id">s2</span> (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">y</span>)) <span class="id">s2</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof18')">Proof.</span></div>
<div class="proofscript" id="proof18">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">agree</span>', <span class="id"><a href="CDF.IMP.html#update">update</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x</span> <span class="id">x0</span>); <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x</span>) (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x0</span>)).<br/>
- <span class="id">apply</span> <span class="id">H</span>. <span class="id">fsetdec</span>.<br/>
- <span class="id">congruence</span>.<br/>
- <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x0</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;+ <span class="id">subst</span> <span class="id">x0</span>. <span class="id">apply</span> <span class="id">H</span>. <span class="id">fsetdec</span>.<br/>
&nbsp;&nbsp;+ <span class="id">exfalso</span>. <span class="id">apply</span> (<span class="id">H0</span> <span class="id">x0</span>); <span class="id">auto</span>.<br/>
- <span class="id">apply</span> <span class="id">H</span>. <span class="id">fsetdec</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Un cas particulier du lemma <span class="bracket"><span class="id">agree</span>'<span class="id">_update_move</span></span> dans le cas où
    <span class="bracket"><span class="id">f</span> <span class="id">x</span> = <span class="id">f</span> <span class="id">y</span></span>, c'est-à-dire que les variables <span class="bracket"><span class="id">x</span></span> et <span class="bracket"><span class="id">y</span></span> se retrouvent
    placées dans la même variable.  Dans ce cas, l'affectation a été
    transformée en <span class="bracket"><span class="id">SKIP</span></span>. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id">agree</span>'<span class="id">_update_coalesced_move</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">L</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">agree</span>' (<span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id"><a href="CDF.Optim.html#remove">IdentSet.remove</a></span> <span class="id">x</span> <span class="id">L</span>) (<span class="id"><a href="CDF.Optim.html#singleton">IdentSet.singleton</a></span> <span class="id">y</span>)) <span class="id">s1</span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">z</span>, <span class="id"><a href="CDF.Optim.html#In">IdentSet.In</a></span> <span class="id">z</span> <span class="id">L</span> -&gt; <span class="id">z</span> &lt;&gt; <span class="id">x</span> -&gt; <span class="id">z</span> &lt;&gt; <span class="id">y</span> -&gt; <span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">z</span> &lt;&gt; <span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x</span> = <span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">agree</span>' <span class="id">L</span> (<span class="id"><a href="CDF.IMP.html#update">update</a></span> <span class="id">x</span> (<span class="id">s1</span> <span class="id">y</span>) <span class="id">s1</span>) <span class="id">s2</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof19')">Proof.</span></div>
<div class="proofscript" id="proof19">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">agree</span>', <span class="id"><a href="CDF.IMP.html#update">update</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x</span> <span class="id">x0</span>); <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x</span>) (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x0</span>)).<br/>
- <span class="id">rewrite</span> &lt;- <span class="id">e0</span>, <span class="id">H1</span>. <span class="id">apply</span> <span class="id">H</span>. <span class="id">fsetdec</span>.<br/>
- <span class="id">congruence</span>.<br/>
- <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x0</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;+ <span class="id">subst</span> <span class="id">x0</span>. <span class="id">apply</span> <span class="id">H</span>. <span class="id">fsetdec</span>.<br/>
&nbsp;&nbsp;+ <span class="id">exfalso</span>. <span class="id">apply</span> (<span class="id">H0</span> <span class="id">x0</span>); <span class="id">auto</span>.<br/>
- <span class="id">apply</span> <span class="id">H</span>. <span class="id">fsetdec</span>.<br/>
Qed.</div>
<br/>
<h3> Préservation sémantique </h3>
<br/>
<div class="doc">En regroupant les différentes hypothèses de non-interférence ci-dessus,
    on obtient une condition de correction pour un renommage <span class="bracket"><span class="id">f</span></span>.
    Si cette condition s'évalue à vrai, le renommage est une allocation
    de registres correcte. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="correct_allocation">correct_allocation</a></span> (<span class="id">c</span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span>) (<span class="id">L</span>: <span class="id"><a href="CDF.Optim.html#t">IdentSet.t</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="CDF.Optim.html#mem">IdentSet.mem</a></span> <span class="id">x</span> <span class="id">L</span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="CDF.Optim.html#expr_is_var">expr_is_var</a></span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Optim.html#for_all">IdentSet.for_all</a></span> (<span class="kwd">fun</span> <span class="id">z</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#eqb">String.eqb</a></span> <span class="id">z</span> <span class="id">x</span> || <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#eqb">String.eqb</a></span> (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">z</span>) (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x</span>))) <span class="id">L</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Optim.html#for_all">IdentSet.for_all</a></span> (<span class="kwd">fun</span> <span class="id">z</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#eqb">String.eqb</a></span> <span class="id">z</span> <span class="id">x</span> || <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#eqb">String.eqb</a></span> <span class="id">z</span> <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#eqb">String.eqb</a></span> (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">z</span>) (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x</span>))) <span class="id">L</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">correct_allocation</span> <span class="id">c1</span> (<span class="id"><a href="CDF.Optim.html#live">live</a></span> <span class="id">c2</span> <span class="id">L</span>) &amp;&amp; <span class="id">correct_allocation</span> <span class="id">c2</span> <span class="id">L</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">correct_allocation</span> <span class="id">c1</span> <span class="id">L</span> &amp;&amp; <span class="id">correct_allocation</span> <span class="id">c2</span> <span class="id">L</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">correct_allocation</span> <span class="id">c</span> (<span class="id"><a href="CDF.Optim.html#live">live</a></span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>) <span class="id">L</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Sous l'hypothèse que le renommage <span class="bracket"><span class="id">f</span></span> satisfait <span class="bracket"><span class="id">correct_allocation</span></span>,
    on démontre la préservation sémantique de l'allocation de registres
    avec le même diagramme de simulation en sémantique naturelle
    que pour l'élimination de code mort.  </div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="regalloc_correct_terminating">regalloc_correct_terminating</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>', <span class="id"><a href="CDF.IMP.html#cexec">cexec</a></span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">L</span> <span class="id">s1</span>,<br/>
&nbsp;&nbsp;<span class="id">agree</span>' (<span class="id"><a href="CDF.Optim.html#live">live</a></span> <span class="id">c</span> <span class="id">L</span>) <span class="id">s</span> <span class="id">s1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Optim.html#correct_allocation">correct_allocation</a></span> <span class="id">c</span> <span class="id">L</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">s1</span>', <span class="id"><a href="CDF.IMP.html#cexec">cexec</a></span> <span class="id">s1</span> (<span class="id"><a href="CDF.Optim.html#regalloc">regalloc</a></span> <span class="id">c</span> <span class="id">L</span>) <span class="id">s1</span>' /\ <span class="id">agree</span>' <span class="id">L</span> <span class="id">s</span>' <span class="id">s1</span>'.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof20')">Proof.</span></div>
<div class="proofscript" id="proof20">
&nbsp;&nbsp;<span class="id">induction</span> 1; <span class="id">intros</span> <span class="id">L</span> <span class="id">s1</span> <span class="id">AG</span> <span class="id">CORR</span>.<br/>
- <span class="comment">(*&nbsp;SKIP&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">s1</span>; <span class="id">split</span>. <span class="id">constructor</span>. <span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;ASSIGN&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> *. <span class="id">destruct</span> (<span class="id"><a href="CDF.Optim.html#mem">IdentSet.mem</a></span> <span class="id">x</span> <span class="id">L</span>) <span class="id">eqn</span>:<span class="id">is_live</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;x&nbsp;est&nbsp;vivante&nbsp;après&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.Optim.html#expr_is_var">expr_is_var</a></span> <span class="id">a</span>) <span class="kwd">as</span> [<span class="id">y</span>|] <span class="id">eqn</span>:<span class="id">is_var</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#expr_is_var_correct">expr_is_var_correct</a></span> <span class="kwd">in</span> <span class="id">is_var</span>. <span class="id">subst</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">NONINTF</span>: <span class="kwd">forall</span> <span class="id">z</span>, <span class="id"><a href="CDF.Optim.html#In">IdentSet.In</a></span> <span class="id">z</span> <span class="id">L</span> -&gt; <span class="id">z</span> &lt;&gt; <span class="id">x</span> -&gt; <span class="id">z</span> &lt;&gt; <span class="id">y</span> -&gt; <span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">z</span> &lt;&gt; <span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#for_all_2">IdentSet.for_all_2</a></span> <span class="kwd">in</span> <span class="id">CORR</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">intros</span>. <span class="id">apply</span> <span class="id">CORR</span> <span class="kwd">in</span> <span class="id">H</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#eqb_spec">String.eqb_spec</a></span> <span class="id">z</span> <span class="id">x</span>). <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#eqb_spec">String.eqb_spec</a></span> <span class="id">z</span> <span class="id">y</span>). <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#eqb_spec">String.eqb_spec</a></span> (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">z</span>) (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x</span>)). <span class="id">discriminate</span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">hnf</span>. <span class="id">intros</span>; <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x</span>) (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">y</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="comment">(*&nbsp;affectation&nbsp;[x&nbsp;:=&nbsp;y]&nbsp;supprimée&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#cexec_skip">cexec_skip</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">agree</span>'<span class="id">_update_coalesced_move</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="comment">(*&nbsp;affectation&nbsp;[x&nbsp;:=&nbsp;y]&nbsp;conservée&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#cexec_assign">cexec_assign</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">agree</span>'<span class="id">_update_move</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;affectation&nbsp;[x&nbsp;:=&nbsp;a],&nbsp;cas&nbsp;général&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">EVAL</span>: <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s</span> = <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> (<span class="id"><a href="CDF.Optim.html#rename_aexp">rename_aexp</a></span> <span class="id">a</span>) <span class="id">s1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">by</span> (<span class="id">eapply</span> <span class="id">aeval_agree</span>'; <span class="id">eapply</span> <span class="id">agree</span>'<span class="id">_mon</span>; <span class="id">eauto</span>; <span class="id">fsetdec</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">NONINTF</span>: <span class="kwd">forall</span> <span class="id">z</span>, <span class="id"><a href="CDF.Optim.html#In">IdentSet.In</a></span> <span class="id">z</span> <span class="id">L</span> -&gt; <span class="id">z</span> &lt;&gt; <span class="id">x</span> -&gt; <span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">z</span> &lt;&gt; <span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#for_all_2">IdentSet.for_all_2</a></span> <span class="kwd">in</span> <span class="id">CORR</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">intros</span>. <span class="id">apply</span> <span class="id">CORR</span> <span class="kwd">in</span> <span class="id">H</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#eqb_spec">String.eqb_spec</a></span> <span class="id">z</span> <span class="id">x</span>). <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#eqb_spec">String.eqb_spec</a></span> (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">z</span>) (<span class="id"><a href="CDF.Optim.html#RENAMING.f">f</a></span> <span class="id">x</span>)). <span class="id">discriminate</span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">hnf</span>. <span class="id">intros</span>; <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#cexec_assign">cexec_assign</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id">EVAL</span>. <span class="id">apply</span> <span class="id">agree</span>'<span class="id">_update_live</span>; <span class="id">auto</span>. <span class="id">eapply</span> <span class="id">agree</span>'<span class="id">_mon</span>; <span class="id">eauto</span>. <span class="id">fsetdec</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;x&nbsp;est&nbsp;morte&nbsp;après&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#cexec_skip">cexec_skip</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">agree</span>'<span class="id">_update_dead</span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span>; <span class="id">intros</span>. <span class="id">assert</span> (<span class="id"><a href="CDF.Optim.html#mem">IdentSet.mem</a></span> <span class="id">x</span> <span class="id">L</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>) <span class="kwd">by</span> (<span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#mem_1">IdentSet.mem_1</a></span>; <span class="id">auto</span>). <span class="id">congruence</span>.<br/>
- <span class="comment">(*&nbsp;SEQ&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> *. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#andb_prop">andb_prop</a></span> <span class="kwd">in</span> <span class="id">CORR</span>; <span class="id">destruct</span> <span class="id">CORR</span> <span class="kwd">as</span> [<span class="id">CORR1</span> <span class="id">CORR2</span>].<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">IHcexec1</span> <span class="id">_</span> <span class="id">_</span> <span class="id">AG</span> <span class="id">CORR1</span>) <span class="kwd">as</span> (<span class="id">s1</span>' &amp; <span class="id">EXEC1</span> &amp; <span class="id">AG1</span>).<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">IHcexec2</span> <span class="id">_</span> <span class="id">_</span> <span class="id">AG1</span> <span class="id">CORR2</span>) <span class="kwd">as</span> (<span class="id">s2</span>' &amp; <span class="id">EXEC2</span> &amp; <span class="id">AG2</span>).<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">s2</span>'; <span class="id">split</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#cexec_seq">cexec_seq</a></span> <span class="kwd">with</span> <span class="id">s1</span>'; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;IFTHENELSE&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> *. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#andb_prop">andb_prop</a></span> <span class="kwd">in</span> <span class="id">CORR</span>; <span class="id">destruct</span> <span class="id">CORR</span> <span class="kwd">as</span> [<span class="id">CORR1</span> <span class="id">CORR2</span>].<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">EVAL</span>: <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> (<span class="id"><a href="CDF.Optim.html#rename_bexp">rename_bexp</a></span> <span class="id">b</span>) <span class="id">s1</span>)<br/>
&nbsp;&nbsp;<span class="kwd">by</span> (<span class="id">eapply</span> <span class="id">beval_agree</span>'; <span class="id">eapply</span> <span class="id">agree</span>'<span class="id">_mon</span>; <span class="id">eauto</span>; <span class="id">fsetdec</span>).<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">IHcexec</span> <span class="id">L</span> <span class="id">s1</span>) <span class="kwd">as</span> (<span class="id">s1</span>' &amp; <span class="id">EXEC</span>' &amp; <span class="id">AG</span>').<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Optim.html#agree_mon">agree_mon</a></span>; <span class="id">eauto</span>. <span class="id">destruct</span> (<span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span>); <span class="id">fsetdec</span>. <span class="id">destruct</span> (<span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">s1</span>'; <span class="id">split</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#cexec_ifthenelse">cexec_ifthenelse</a></span>. <span class="id">rewrite</span> &lt;- <span class="id">EVAL</span>. <span class="id">destruct</span> (<span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;WHILE&nbsp;done&nbsp;*)</span><br/>
<span class="id">Local</span> <span class="kwd">Opaque</span> <span class="id"><a href="CDF.Optim.html#live">live</a></span>.<br/>
&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.Optim.html#live_while_charact">live_while_charact</a></span> <span class="id">b</span> <span class="id">c</span> <span class="id">L</span>) <span class="kwd">as</span> (<span class="id">P</span> &amp; <span class="id">Q</span> &amp; <span class="id">R</span>).<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">EVAL</span>: <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> (<span class="id"><a href="CDF.Optim.html#rename_bexp">rename_bexp</a></span> <span class="id">b</span>) <span class="id">s1</span>)<br/>
&nbsp;&nbsp;<span class="kwd">by</span> (<span class="id">eapply</span> <span class="id">beval_agree</span>'; <span class="id">eapply</span> <span class="id">agree</span>'<span class="id">_mon</span>; <span class="id">eauto</span>; <span class="id">fsetdec</span>).<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">s1</span>; <span class="id">split</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#cexec_while_done">cexec_while_done</a></span>. <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Optim.html#agree_mon">agree_mon</a></span>; <span class="id">eauto</span>.<br/>
- <span class="comment">(*&nbsp;WHILE&nbsp;loop&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.Optim.html#live_while_charact">live_while_charact</a></span> <span class="id">b</span> <span class="id">c</span> <span class="id">L</span>) <span class="kwd">as</span> (<span class="id">P</span> &amp; <span class="id">Q</span> &amp; <span class="id">R</span>).<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">EVAL</span>: <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> (<span class="id"><a href="CDF.Optim.html#rename_bexp">rename_bexp</a></span> <span class="id">b</span>) <span class="id">s1</span>)<br/>
&nbsp;&nbsp;<span class="kwd">by</span> (<span class="id">eapply</span> <span class="id">beval_agree</span>'; <span class="id">eapply</span> <span class="id">agree</span>'<span class="id">_mon</span>; <span class="id">eauto</span>; <span class="id">fsetdec</span>).<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">IHcexec1</span> (<span class="id"><a href="CDF.Optim.html#live">live</a></span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>) <span class="id">L</span>) <span class="id">s1</span>) <span class="kwd">as</span> (<span class="id">s1</span>' &amp; <span class="id">EXEC1</span> &amp; <span class="id">AG1</span>).<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Optim.html#agree_mon">agree_mon</a></span>; <span class="id">eauto</span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">IHcexec2</span> <span class="id">L</span> <span class="id">s1</span>') <span class="kwd">as</span> (<span class="id">s2</span>' &amp; <span class="id">EXEC2</span> &amp; <span class="id">AG2</span>).<br/>
&nbsp;&nbsp;<span class="id">auto</span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">s2</span>'; <span class="id">split</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#cexec_while_loop">cexec_while_loop</a></span> <span class="kwd">with</span> <span class="id">s1</span>'; <span class="id">auto</span>. <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;<span class="id">auto</span>.<br/>
<span class="id">Local</span> <span class="kwd">Transparent</span> <span class="id"><a href="CDF.Optim.html#live">live</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.Optim.html#RENAMING">RENAMING</a></span>.<br/>
<br/>
<h3> Exemples </h3>
<br/>
<div class="doc">Si le renommage est la fonction identité, l'allocation de registres
    se comporte exactement comme l'élimination de code mort. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="trivial_alloc">trivial_alloc</a></span> := <span class="kwd">fun</span> (<span class="id">x</span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span>) =&gt; <span class="id">x</span>.<br/>
<br/>
<span class="kwd">Eval</span> <span class="id">compute</span> <span class="kwd">in</span> (<span class="id"><a href="CDF.Optim.html#correct_allocation">correct_allocation</a></span> <span class="id"><a href="CDF.Optim.html#trivial_alloc">trivial_alloc</a></span> <span class="id"><a href="CDF.IMP.html#Euclidean_division">Euclidean_division</a></span> (<span class="id"><a href="CDF.Optim.html#singleton">IdentSet.singleton</a></span> "<span class="id">r</span>")).<br/>
<br/>
<div class="doc">Résultat <span class="bracket"><span class="id">true</span></span>. </div>
<br/>
<span class="kwd">Eval</span> <span class="id">compute</span> <span class="kwd">in</span> (<span class="id"><a href="CDF.Optim.html#regalloc">regalloc</a></span> <span class="id"><a href="CDF.Optim.html#trivial_alloc">trivial_alloc</a></span> <span class="id"><a href="CDF.IMP.html#Euclidean_division">Euclidean_division</a></span> (<span class="id"><a href="CDF.Optim.html#singleton">IdentSet.singleton</a></span> "<span class="id">r</span>")).<br/>
<br/>
<div class="doc">Result is:
<pre>
   r := a;                 ===&gt;   r := a;
   q := 0;                        skip;
   while b &lt;= r do                while b &lt;= r do
     r := r - b;                    r := r - b;
     q := q + 1;                    skip;
   done                           done</pre>
</div>
<br/>
<div class="doc">Voici un renommage non trivial qui place les variables "r" et "a" dans
    le même registre "a". </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="my_alloc">my_alloc</a></span> := <span class="kwd">fun</span> (<span class="id">x</span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span>) =&gt; <span class="kwd">if</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x</span> "<span class="id">r</span>" <span class="kwd">then</span> "<span class="id">a</span>" <span class="kwd">else</span> <span class="id">x</span>.<br/>
<br/>
<span class="kwd">Eval</span> <span class="id">compute</span> <span class="kwd">in</span> (<span class="id"><a href="CDF.Optim.html#correct_allocation">correct_allocation</a></span> <span class="id"><a href="CDF.Optim.html#my_alloc">my_alloc</a></span> <span class="id"><a href="CDF.IMP.html#Euclidean_division">Euclidean_division</a></span> (<span class="id"><a href="CDF.Optim.html#singleton">IdentSet.singleton</a></span> "<span class="id">r</span>")).<br/>
<br/>
<div class="doc">Résultat <span class="bracket"><span class="id">true</span></span>. </div>
<br/>
<span class="kwd">Eval</span> <span class="id">compute</span> <span class="kwd">in</span> (<span class="id"><a href="CDF.Optim.html#regalloc">regalloc</a></span> <span class="id"><a href="CDF.Optim.html#my_alloc">my_alloc</a></span> <span class="id"><a href="CDF.IMP.html#Euclidean_division">Euclidean_division</a></span> (<span class="id"><a href="CDF.Optim.html#singleton">IdentSet.singleton</a></span> "<span class="id">r</span>")).<br/>
<br/>
<div class="doc">Voici le résultat.  On voit que l'affectation <span class="bracket"><span class="id">r</span> := <span class="id">a</span></span> a été supprimée.
<pre>
   r := a;                 ===&gt;   skip;
   q := 0;                        skip;
   while b &lt;= r do                while b &lt;= a do
     r := r - b;                    a := a - b;
     q := q + 1;                    skip;
   done                           done</pre>
</div>
<br/>
<div class="doc">En revanche, si nous essayons de placer les variables <span class="bracket"><span class="id">r</span></span> et <span class="bracket"><span class="id">b</span></span>
   au même endroit, la fonction de validation <span class="bracket"><span class="id">correct_allocation</span></span>
   rejette cette allocation. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="wrong_alloc">wrong_alloc</a></span> := <span class="kwd">fun</span> (<span class="id">x</span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span>) =&gt; <span class="kwd">if</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x</span> "<span class="id">r</span>" <span class="kwd">then</span> "<span class="id">b</span>" <span class="kwd">else</span> <span class="id">x</span>.<br/>
<br/>
<span class="kwd">Eval</span> <span class="id">compute</span> <span class="kwd">in</span> (<span class="id"><a href="CDF.Optim.html#correct_allocation">correct_allocation</a></span> <span class="id"><a href="CDF.Optim.html#my_alloc">my_alloc</a></span> <span class="id"><a href="CDF.IMP.html#Euclidean_division">Euclidean_division</a></span> (<span class="id"><a href="CDF.Optim.html#singleton">IdentSet.singleton</a></span> "<span class="id">r</span>")).<br/>
<br/>
<div class="doc">Résultat <span class="bracket"><span class="id">faux</span></span>. </div>
<br/>
<h2> 3.4. Pour aller plus loin: les points fixes </h2>
<br/>
<div class="doc">La bibliothèque <span class="bracket"><span class="id">Fixpoints</span></span> montre comment calculer des points
    fixes exacts en suivant l'approche du théorème de
    Knaster-Tarski. </div>
<br/>
<span class="kwd">From</span> <span class="id">CDF</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="CDF.Fixpoints.html">Fixpoints</a></span>.<br/>
<br/>
<div class="doc">Dans cette section, nous allons appliquer cette approche à l'analyse des
    variables libres. </div>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="FIXPOINT_FINITE_SETS">FIXPOINT_FINITE_SETS</a></span>.<br/>
<br/>
<div class="doc">Première difficulté: l'ordre d'inclusion entre ensembles finis de
    variables n'est pas bien fondé!  Par exemple, on a la suite
    infinie croissante
<pre>
  {}, {"0"}, {"0","1"}, {"0","1","2"}, {"0","1","2","3"}, ...</pre>
    Il faut donc nous restreindre aux sous-ensembles d'un univers <span class="bracket"><span class="id">U</span></span>
    fini de variables, typiquement toutes les variables qui sont
    mentionnées dans le programme à analyser.
</div>
<br/>
<span class="kwd">Variable</span> <span class="id"><a name="FIXPOINT_FINITE_SETS.U">U</a></span>: <span class="id"><a href="CDF.Optim.html#t">IdentSet.t</a></span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="finset">finset</a></span> := { <span class="id">x</span>: <span class="id"><a href="CDF.Optim.html#t">IdentSet.t</a></span> | <span class="id"><a href="CDF.Optim.html#Subset">IdentSet.Subset</a></span> <span class="id">x</span> <span class="id"><a href="CDF.Optim.html#FIXPOINT_FINITE_SETS.U">U</a></span> }.<br/>
<br/>
<div class="doc">Nous munissons le type <span class="bracket"><span class="id">finset</span></span> des opérations et des propriétés
    attendues par la bibliothèque <span class="bracket"><span class="id">Fixpoints</span></span>. </div>
<br/>
<span class="id">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="finset_eq">finset_eq</a></span> (<span class="id">x</span> <span class="id">y</span>: <span class="id"><a href="CDF.Optim.html#finset">finset</a></span>) := <span class="id"><a href="CDF.Optim.html#Equal">IdentSet.Equal</a></span> <span class="id">x</span> <span class="id">y</span>.<br/>
<br/>
<span class="id">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="finset_eq_dec">finset_eq_dec</a></span> (<span class="id">x</span> <span class="id">y</span>: <span class="id"><a href="CDF.Optim.html#finset">finset</a></span>) : {<span class="id"><a href="CDF.Optim.html#finset_eq">finset_eq</a></span> <span class="id">x</span> <span class="id">y</span>} + {~<span class="id"><a href="CDF.Optim.html#finset_eq">finset_eq</a></span> <span class="id">x</span> <span class="id">y</span>} :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="CDF.Optim.html#equal">IdentSet.equal</a></span> <span class="id">x</span> <span class="id">y</span> <span class="kwd">with</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#left">left</a></span> <span class="id">_</span> | <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#right">right</a></span> <span class="id">_</span> <span class="kwd">end</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof21')">Next Obligation.</span></div>
<div class="proofscript" id="proof21">
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#equal_2">IdentSet.equal_2</a></span>; <span class="id">auto</span>.<br/>
Qed.</div>
<div><span class="toggleproof" onclick="toggleDisplay('proof22')">Next Obligation.</span></div>
<div class="proofscript" id="proof22">
&nbsp;&nbsp;<span class="id">red</span>; <span class="id">intros</span>. <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#equal_1">IdentSet.equal_1</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="id">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="finset_le">finset_le</a></span> (<span class="id">x</span> <span class="id">y</span>: <span class="id"><a href="CDF.Optim.html#finset">finset</a></span>) := <span class="id"><a href="CDF.Optim.html#Subset">IdentSet.Subset</a></span> <span class="id">x</span> <span class="id">y</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="finset_le_trans">finset_le_trans</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span>, <span class="id"><a href="CDF.Optim.html#finset_le">finset_le</a></span> <span class="id">x</span> <span class="id">y</span> -&gt; <span class="id"><a href="CDF.Optim.html#finset_le">finset_le</a></span> <span class="id">y</span> <span class="id">z</span> -&gt; <span class="id"><a href="CDF.Optim.html#finset_le">finset_le</a></span> <span class="id">x</span> <span class="id">z</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof23')">Proof.</span></div>
<div class="proofscript" id="proof23">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span>; <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#subset_trans">ISProp.subset_trans</a></span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="finset_eq_le">finset_eq_le</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id"><a href="CDF.Optim.html#finset_eq">finset_eq</a></span> <span class="id">x</span> <span class="id">y</span> -&gt; <span class="id"><a href="CDF.Optim.html#finset_le">finset_le</a></span> <span class="id">y</span> <span class="id">x</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof24')">Proof.</span></div>
<div class="proofscript" id="proof24">
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#subset_equal">ISProp.subset_equal</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#equal_sym">ISProp.equal_sym</a></span>. <span class="id">apply</span> <span class="id">H</span>.<br/>
Qed.</div>
<br/>
<span class="id">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="finset_bot">finset_bot</a></span> : <span class="id"><a href="CDF.Optim.html#finset">finset</a></span> := <span class="id"><a href="CDF.Optim.html#empty">IdentSet.empty</a></span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof25')">Next Obligation.</span></div>
<div class="proofscript" id="proof25">
&nbsp;&nbsp;<span class="id">fsetdec</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="finset_bot_smallest">finset_bot_smallest</a></span>: <span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="CDF.Optim.html#finset_le">finset_le</a></span> <span class="id"><a href="CDF.Optim.html#finset_bot">finset_bot</a></span> <span class="id">x</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof26')">Proof.</span></div>
<div class="proofscript" id="proof26">
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">red</span>; <span class="id">fsetdec</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Il faut démontrer que l'ordre strict induit par inclusion est bien
    fondé.  Pour cela nous raisonnons sur les cardinaux (nombre
    d'éléments) des ensembles de variables, qui ne peuvent pas
    dépasser le cardinal de l'univers <span class="bracket"><span class="id">U</span></span>. </div>
<br/>
<span class="id">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="finset_cardinal">finset_cardinal</a></span> (<span class="id">x</span>: <span class="id"><a href="CDF.Optim.html#finset">finset</a></span>) := <span class="id"><a href="CDF.Optim.html#cardinal">IdentSet.cardinal</a></span> <span class="id">x</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="finset_cardinal_max">finset_cardinal_max</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, (<span class="id"><a href="CDF.Optim.html#finset_cardinal">finset_cardinal</a></span> <span class="id">x</span> &lt;= <span class="id"><a href="CDF.Optim.html#cardinal">IdentSet.cardinal</a></span> <span class="id"><a href="CDF.Optim.html#FIXPOINT_FINITE_SETS.U">U</a></span>)%<span class="id">nat</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof27')">Proof.</span></div>
<div class="proofscript" id="proof27">
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#subset_cardinal">ISProp.subset_cardinal</a></span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#proj2_sig">proj2_sig</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="finset_cardinal_le">finset_cardinal_le</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id"><a href="CDF.Optim.html#finset_le">finset_le</a></span> <span class="id">x</span> <span class="id">y</span> -&gt; (<span class="id"><a href="CDF.Optim.html#finset_cardinal">finset_cardinal</a></span> <span class="id">x</span> &lt;= <span class="id"><a href="CDF.Optim.html#finset_cardinal">finset_cardinal</a></span> <span class="id">y</span>)%<span class="id">nat</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof28')">Proof.</span></div>
<div class="proofscript" id="proof28">
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#subset_cardinal">ISProp.subset_cardinal</a></span>. <span class="id">apply</span> <span class="id">H</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="finset_cardinal_lt">finset_cardinal_lt</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Optim.html#finset_le">finset_le</a></span> <span class="id">x</span> <span class="id">y</span> -&gt; ~<span class="id"><a href="CDF.Optim.html#finset_eq">finset_eq</a></span> <span class="id">x</span> <span class="id">y</span> -&gt; (<span class="id"><a href="CDF.Optim.html#finset_cardinal">finset_cardinal</a></span> <span class="id">x</span> &lt; <span class="id"><a href="CDF.Optim.html#finset_cardinal">finset_cardinal</a></span> <span class="id">y</span>)%<span class="id">nat</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof29')">Proof.</span></div>
<div class="proofscript" id="proof29">
&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.Optim.html#choose">IdentSet.choose</a></span> (<span class="id"><a href="CDF.Optim.html#diff">IdentSet.diff</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">y</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">x</span>))) <span class="kwd">as</span> [<span class="id">elt</span>|] <span class="id">eqn</span>:<span class="id">CHOOSE</span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#choose_1">IdentSet.choose_1</a></span> <span class="kwd">in</span> <span class="id">CHOOSE</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#subset_cardinal_lt">ISProp.subset_cardinal_lt</a></span> <span class="kwd">with</span> <span class="id">elt</span>. <span class="id">auto</span>. <span class="id">fsetdec</span>. <span class="id">fsetdec</span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#choose_2">IdentSet.choose_2</a></span> <span class="kwd">in</span> <span class="id">CHOOSE</span>.<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="CDF.Optim.html#finset_le">finset_le</a></span> <span class="id">y</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;{ <span class="id">intros</span> <span class="id">e</span> <span class="id">IN</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.Optim.html#In_dec">ISProp.In_dec</a></span> <span class="id">e</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">x</span>)); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">elim</span> (<span class="id">CHOOSE</span> <span class="id">e</span>). <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#diff_3">IdentSet.diff_3</a></span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;<span class="id">elim</span> <span class="id">H0</span>. <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#subset_antisym">ISProp.subset_antisym</a></span>; <span class="id">auto</span>.<br/>
Qed.</div>
&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="finset_gt_wf">finset_gt_wf</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Wf.html#well_founded">well_founded</a></span> (<span class="kwd">fun</span> <span class="id">x</span> <span class="id">y</span> =&gt; <span class="id"><a href="CDF.Optim.html#finset_le">finset_le</a></span> <span class="id">y</span> <span class="id">x</span> /\ ~<span class="id"><a href="CDF.Optim.html#finset_eq">finset_eq</a></span> <span class="id">y</span> <span class="id">x</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof30')">Proof.</span></div>
<div class="proofscript" id="proof30">
&nbsp;&nbsp;<span class="id">set</span> (<span class="id">M</span> := <span class="kwd">fun</span> <span class="id">x</span> =&gt; (<span class="id"><a href="CDF.Optim.html#cardinal">IdentSet.cardinal</a></span> <span class="id"><a href="CDF.Optim.html#FIXPOINT_FINITE_SETS.U">U</a></span> - <span class="id"><a href="CDF.Optim.html#finset_cardinal">finset_cardinal</a></span> <span class="id">x</span>)%<span class="id">nat</span>).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Wellfounded.Inclusion.html#wf_incl">wf_incl</a></span> <span class="kwd">with</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Wf_nat.html#ltof">ltof</a></span> <span class="id">_</span> <span class="id">M</span>).<br/>
- <span class="id">red</span>; <span class="id">intros</span> <span class="id">x</span> <span class="id">y</span> [<span class="id">L</span> <span class="id">E</span>]; <span class="id">red</span>. <span class="id">unfold</span> <span class="id">M</span>.<br/>
&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="CDF.Optim.html#finset_cardinal_max">finset_cardinal_max</a></span> <span class="id">x</span>), (<span class="id"><a href="CDF.Optim.html#finset_cardinal_max">finset_cardinal_max</a></span> <span class="id">y</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CDF.Optim.html#finset_cardinal_lt">finset_cardinal_lt</a></span> <span class="id">y</span> <span class="id">x</span> <span class="id">L</span> <span class="id">E</span>); <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">lia</span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Wf_nat.html#well_founded_ltof">well_founded_ltof</a></span>.<br/>
Qed.</div>
<br/>
<div class="doc">Nous pouvons maintenant instancier le calcul de point fixe 
    fourni par la bibliothèque <span class="bracket"><span class="id">Fixpoints</span></span>. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="monotone">monotone</a></span> (<span class="id">F</span>: <span class="id"><a href="CDF.Optim.html#finset">finset</a></span> -&gt; <span class="id"><a href="CDF.Optim.html#finset">finset</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id"><a href="CDF.Optim.html#finset_le">finset_le</a></span> <span class="id">x</span> <span class="id">y</span> -&gt; <span class="id"><a href="CDF.Optim.html#finset_le">finset_le</a></span> (<span class="id">F</span> <span class="id">x</span>) (<span class="id">F</span> <span class="id">y</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="finset_fixpoint">finset_fixpoint</a></span> (<span class="id">F</span>: <span class="id"><a href="CDF.Optim.html#finset">finset</a></span> -&gt; <span class="id"><a href="CDF.Optim.html#finset">finset</a></span>) (<span class="id">M</span>: <span class="id"><a href="CDF.Optim.html#monotone">monotone</a></span> <span class="id">F</span>) : <span class="id"><a href="CDF.Optim.html#finset">finset</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Fixpoints.html#fixpoint">fixpoint</a></span> <span class="id"><a href="CDF.Optim.html#finset">finset</a></span> <span class="id"><a href="CDF.Optim.html#finset_eq">finset_eq</a></span> <span class="id"><a href="CDF.Optim.html#finset_eq_dec">finset_eq_dec</a></span> <span class="id"><a href="CDF.Optim.html#finset_le">finset_le</a></span> <span class="id"><a href="CDF.Optim.html#finset_gt_wf">finset_gt_wf</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Optim.html#finset_bot">finset_bot</a></span> <span class="id"><a href="CDF.Optim.html#finset_bot_smallest">finset_bot_smallest</a></span> <span class="id">F</span> <span class="id">M</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="finset_fixpoint_eq">finset_fixpoint_eq</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">F</span> <span class="id">M</span>, <span class="id"><a href="CDF.Optim.html#finset_eq">finset_eq</a></span> (<span class="id"><a href="CDF.Optim.html#finset_fixpoint">finset_fixpoint</a></span> <span class="id">F</span> <span class="id">M</span>) (<span class="id">F</span> (<span class="id"><a href="CDF.Optim.html#finset_fixpoint">finset_fixpoint</a></span> <span class="id">F</span> <span class="id">M</span>)).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof31')">Proof.</span></div>
<div class="proofscript" id="proof31">
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">unfold</span> <span class="id"><a href="CDF.Optim.html#finset_fixpoint">finset_fixpoint</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.Fixpoints.html#fixpoint_eq">fixpoint_eq</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="finset_fixpoint_smallest">finset_fixpoint_smallest</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">F</span> <span class="id">M</span> <span class="id">z</span>, <span class="id"><a href="CDF.Optim.html#finset_le">finset_le</a></span> (<span class="id">F</span> <span class="id">z</span>) <span class="id">z</span> -&gt; <span class="id"><a href="CDF.Optim.html#finset_le">finset_le</a></span> (<span class="id"><a href="CDF.Optim.html#finset_fixpoint">finset_fixpoint</a></span> <span class="id">F</span> <span class="id">M</span>) <span class="id">z</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof32')">Proof.</span></div>
<div class="proofscript" id="proof32">
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">unfold</span> <span class="id"><a href="CDF.Optim.html#finset_fixpoint">finset_fixpoint</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.Fixpoints.html#fixpoint_smallest">fixpoint_smallest</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.Optim.html#finset_le_trans">finset_le_trans</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="finset_fixpoint_mon">finset_fixpoint_mon</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">F1</span> <span class="id">M1</span> <span class="id">F2</span> <span class="id">M2</span>,<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="CDF.Optim.html#finset_le">finset_le</a></span> (<span class="id">F1</span> <span class="id">x</span>) (<span class="id">F2</span> <span class="id">x</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Optim.html#finset_le">finset_le</a></span> (<span class="id"><a href="CDF.Optim.html#finset_fixpoint">finset_fixpoint</a></span> <span class="id">F1</span> <span class="id">M1</span>) (<span class="id"><a href="CDF.Optim.html#finset_fixpoint">finset_fixpoint</a></span> <span class="id">F2</span> <span class="id">M2</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof33')">Proof.</span></div>
<div class="proofscript" id="proof33">
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">unfold</span> <span class="id"><a href="CDF.Optim.html#finset_fixpoint">finset_fixpoint</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.Fixpoints.html#fixpoint_mon">fixpoint_mon</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.Optim.html#finset_le_trans">finset_le_trans</a></span>, <span class="id"><a href="CDF.Optim.html#finset_eq_le">finset_eq_le</a></span>.<br/>
Qed.</div>
<br/>
<div class="doc">Essayons de redéfinir l'analyse de vivacité en utilisant 
    les ensembles finis <span class="bracket"><span class="id">finset</span></span> et le calcul de point fixe <span class="bracket"><span class="id">finset_fixpoint</span></span>.
</div>
&nbsp;<br/>
<span class="kwd">Fail</span> <span class="kwd">Fixpoint</span> <span class="id">live</span>' (<span class="id">c</span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span>) (<span class="id">L</span>: <span class="id"><a href="CDF.Optim.html#finset">finset</a></span>) : <span class="id"><a href="CDF.Optim.html#finset">finset</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span> =&gt; <span class="id">L</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="CDF.Optim.html#mem">IdentSet.mem</a></span> <span class="id">x</span> <span class="id">L</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id"><a href="CDF.Optim.html#remove">IdentSet.remove</a></span> <span class="id">x</span> <span class="id">L</span>) (<span class="id"><a href="CDF.Optim.html#fv_aexp">fv_aexp</a></span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">L</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">live</span>' <span class="id">c1</span> (<span class="id">live</span>' <span class="id">c2</span> <span class="id">L</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id"><a href="CDF.Optim.html#fv_bexp">fv_bexp</a></span> <span class="id">b</span>) (<span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id">live</span>' <span class="id">c1</span> <span class="id">L</span>) (<span class="id">live</span>' <span class="id">c2</span> <span class="id">L</span>))<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">L</span>' := <span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id"><a href="CDF.Optim.html#fv_bexp">fv_bexp</a></span> <span class="id">b</span>) <span class="id">L</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Optim.html#finset_fixpoint">finset_fixpoint</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> <span class="id">L</span>' (<span class="id">live</span>' <span class="id">c</span> <span class="id">x</span>)) <span class="id">_</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Premier problème: lorsqu'on fait l'union de <span class="bracket"><span class="id">L</span></span> avec <span class="bracket"><span class="id">fv_aexp</span> <span class="id">a</span></span> ou
    <span class="bracket"><span class="id">fv_bexp</span> <span class="id">b</span></span>, rien ne garantit qu'on reste dans l'univers <span class="bracket"><span class="id">U</span></span> des
    variables du programme.  Il faut donc ajouter une hypothèse 
    <span class="bracket"><span class="id">IdentSet.Subset</span> (<span class="id">fv_com</span> <span class="id">c</span>) <span class="id">U</span></span> pour garantir que le programme <span class="bracket"><span class="id">c</span></span>
    en cours d'analyse est bien "contenu" dans l'univers <span class="bracket"><span class="id">U</span></span>.
    Second problème: afin d'utiliser <span class="bracket"><span class="id">finset_fixpoint</span></span> dans le cas
    <span class="bracket"><span class="id">WHILE</span></span>, il faut lui passer une preuve que sa fonction argument
    est croissante.  Pour ce faire, il faut savoir que <span class="bracket"><span class="id">live</span>' <span class="id">c</span></span> est
    une fonction croissante de <span class="bracket"><span class="id">finset</span></span> dans <span class="bracket"><span class="id">finset</span></span>, alors même que
    nous sommes en train de la définir!  Il faut donc définir <span class="bracket"><span class="id">live</span>'</span>
    et montrer qu'elle est croissante simultanément.
</div>
<br/>
<span class="id">Program</span> <span class="kwd">Fixpoint</span> <span class="id">live</span>' (<span class="id">c</span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span>) (<span class="id">CONT</span>: <span class="id"><a href="CDF.Optim.html#Subset">IdentSet.Subset</a></span> (<span class="id"><a href="CDF.Optim.html#fv_com">fv_com</a></span> <span class="id">c</span>) <span class="id"><a href="CDF.Optim.html#FIXPOINT_FINITE_SETS.U">U</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: { <span class="id">f</span>: <span class="id"><a href="CDF.Optim.html#finset">finset</a></span> -&gt; <span class="id"><a href="CDF.Optim.html#finset">finset</a></span> | <span class="id"><a href="CDF.Optim.html#monotone">monotone</a></span> <span class="id">f</span> } :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span> =&gt; <span class="kwd">fun</span> <span class="id">L</span> =&gt; <span class="id">L</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">L</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="CDF.Optim.html#mem">IdentSet.mem</a></span> <span class="id">x</span> <span class="id">L</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id"><a href="CDF.Optim.html#remove">IdentSet.remove</a></span> <span class="id">x</span> <span class="id">L</span>) (<span class="id"><a href="CDF.Optim.html#fv_aexp">fv_aexp</a></span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">L</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">L</span> =&gt; <span class="id">live</span>' <span class="id">c1</span> <span class="id">_</span> (<span class="id">live</span>' <span class="id">c2</span> <span class="id">_</span> <span class="id">L</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">L</span> =&gt; <span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id"><a href="CDF.Optim.html#fv_bexp">fv_bexp</a></span> <span class="id">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id">live</span>' <span class="id">c1</span> <span class="id">_</span> <span class="id">L</span>) (<span class="id">live</span>' <span class="id">c2</span> <span class="id">_</span> <span class="id">L</span>))<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">L</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">L</span>' := <span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> (<span class="id"><a href="CDF.Optim.html#fv_bexp">fv_bexp</a></span> <span class="id">b</span>) <span class="id">L</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Optim.html#finset_fixpoint">finset_fixpoint</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="CDF.Optim.html#union">IdentSet.union</a></span> <span class="id">L</span>' (<span class="id">live</span>' <span class="id">c</span> <span class="id">_</span> <span class="id">x</span>)) <span class="id">_</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof34')">Next Obligation.</span></div>
<div class="proofscript" id="proof34">
&nbsp;&nbsp;<span class="id">red</span>; <span class="id">auto</span>.<br/>
Defined.</div>
<div><span class="toggleproof" onclick="toggleDisplay('proof35')">Next Obligation.</span></div>
<div class="proofscript" id="proof35">
&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> <span class="id">CONT</span>. <span class="id">generalize</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#proj2_sig">proj2_sig</a></span> <span class="id">L</span>). <span class="id">fsetdec</span>.<br/>
Defined.</div>
<div><span class="toggleproof" onclick="toggleDisplay('proof36')">Next Obligation.</span></div>
<div class="proofscript" id="proof36">
&nbsp;&nbsp;<span class="id">red</span>; <span class="id">intros</span>. <span class="id">rename</span> <span class="id">x0</span> <span class="id">into</span> <span class="id">L1</span>. <span class="id">rename</span> <span class="id">y</span> <span class="id">into</span> <span class="id">L2</span>. <span class="id">unfold</span> <span class="id"><a href="CDF.Optim.html#finset_le">finset_le</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.Optim.html#mem">IdentSet.mem</a></span> <span class="id">x</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">L1</span>)) <span class="id">eqn</span>:<span class="id">M1</span>; <span class="id">cbn</span>.<br/>
- <span class="id">replace</span> (<span class="id"><a href="CDF.Optim.html#mem">IdentSet.mem</a></span> <span class="id">x</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">L2</span>)) <span class="kwd">with</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>. <br/>
&nbsp;&nbsp;<span class="id">cbn</span>. <span class="id">fsetdec</span>.<br/>
&nbsp;&nbsp;<span class="id">symmetry</span>. <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#mem_1">IdentSet.mem_1</a></span>. <span class="id">apply</span> <span class="id">H</span>. <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#mem_2">IdentSet.mem_2</a></span>; <span class="id">auto</span>.<br/>
- <span class="id">destruct</span> (<span class="id"><a href="CDF.Optim.html#mem">IdentSet.mem</a></span> <span class="id">x</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">L2</span>)) <span class="id">eqn</span>:<span class="id">M2</span>; <span class="id">cbn</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#mem_2">IdentSet.mem_2</a></span> <span class="kwd">in</span> <span class="id">M2</span>. <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#not_mem_iff">ISFact.not_mem_iff</a></span> <span class="kwd">in</span> <span class="id">M1</span>.<br/>
&nbsp;&nbsp;<span class="id">red</span>; <span class="id">intros</span> <span class="id">z</span> <span class="id">IN</span>. <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#union_2">IdentSet.union_2</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#remove_2">IdentSet.remove_2</a></span>. <span class="id">congruence</span>. <span class="id">auto</span>.<br/>
Defined.</div>
<div><span class="toggleproof" onclick="toggleDisplay('proof37')">Next Obligation.</span></div>
<div class="proofscript" id="proof37">
&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> <span class="id">CONT</span>; <span class="id">fsetdec</span>.<br/>
Defined.</div>
<div><span class="toggleproof" onclick="toggleDisplay('proof38')">Next Obligation.</span></div>
<div class="proofscript" id="proof38">
&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> <span class="id">CONT</span>; <span class="id">fsetdec</span>.<br/>
Defined.</div>
<div><span class="toggleproof" onclick="toggleDisplay('proof39')">Next Obligation.</span></div>
<div class="proofscript" id="proof39">
&nbsp;&nbsp;<span class="id">red</span>; <span class="id">intros</span>. <span class="id">auto</span>.<br/>
Defined.</div>
<div><span class="toggleproof" onclick="toggleDisplay('proof40')">Next Obligation.</span></div>
<div class="proofscript" id="proof40">
&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> <span class="id">CONT</span>; <span class="id">fsetdec</span>.<br/>
Defined.</div>
<div><span class="toggleproof" onclick="toggleDisplay('proof41')">Next Obligation.</span></div>
<div class="proofscript" id="proof41">
&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> <span class="id">CONT</span>; <span class="id">fsetdec</span>.<br/>
Defined.</div>
<div><span class="toggleproof" onclick="toggleDisplay('proof42')">Next Obligation.</span></div>
<div class="proofscript" id="proof42">
&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> <span class="id">CONT</span>. <span class="id">generalize</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#proj2_sig">proj2_sig</a></span> (<span class="id">x</span> <span class="id">L</span>)), (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#proj2_sig">proj2_sig</a></span> (<span class="id">x0</span> <span class="id">L</span>)); <span class="id">fsetdec</span>.<br/>
Defined.</div>
<div><span class="toggleproof" onclick="toggleDisplay('proof43')">Next Obligation.</span></div>
<div class="proofscript" id="proof43">
&nbsp;&nbsp;<span class="id">red</span>; <span class="id">intros</span>; <span class="id">unfold</span> <span class="id"><a href="CDF.Optim.html#finset_le">finset_le</a></span>; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">live</span>' <span class="id">c1</span>) <span class="kwd">as</span> [<span class="id">f1</span> <span class="id">M1</span>], (<span class="id">live</span>' <span class="id">c2</span>) <span class="kwd">as</span> [<span class="id">f2</span> <span class="id">M2</span>]. <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#union_subset_5">ISProp.union_subset_5</a></span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#union_s_m">ISProp.FM.union_s_m</a></span>. <span class="id">apply</span> <span class="id">M1</span>; <span class="id">auto</span>. <span class="id">apply</span> <span class="id">M2</span>; <span class="id">auto</span>.<br/>
Defined.</div>
<div><span class="toggleproof" onclick="toggleDisplay('proof44')">Next Obligation.</span></div>
<div class="proofscript" id="proof44">
&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> <span class="id">CONT</span>; <span class="id">fsetdec</span>.<br/>
Defined.</div>
<div><span class="toggleproof" onclick="toggleDisplay('proof45')">Next Obligation.</span></div>
<div class="proofscript" id="proof45">
&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> <span class="id">CONT</span>. <span class="id">generalize</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#proj2_sig">proj2_sig</a></span> (<span class="id">x0</span> <span class="id">x</span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#proj2_sig">proj2_sig</a></span> <span class="id">L</span>). <span class="id">fsetdec</span>.<br/>
Defined.</div>
<div><span class="toggleproof" onclick="toggleDisplay('proof46')">Next Obligation.</span></div>
<div class="proofscript" id="proof46">
&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> <span class="id">CONT</span>. <span class="id">red</span>; <span class="id">intros</span>; <span class="id">unfold</span> <span class="id"><a href="CDF.Optim.html#finset_le">finset_le</a></span>; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">live</span>' <span class="id">c</span>) <span class="kwd">as</span> [<span class="id">f</span> <span class="id">M</span>]; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#union_subset_5">ISProp.union_subset_5</a></span>. <span class="id">apply</span> <span class="id">M</span>; <span class="id">auto</span>.<br/>
Defined.</div>
<div><span class="toggleproof" onclick="toggleDisplay('proof47')">Next Obligation.</span></div>
<div class="proofscript" id="proof47">
&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> <span class="id">CONT</span>. <span class="id">red</span>; <span class="id">intros</span>. <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#finset_fixpoint_mon">finset_fixpoint_mon</a></span>.<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">z</span>; <span class="id">unfold</span> <span class="id"><a href="CDF.Optim.html#finset_le">finset_le</a></span>; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">live</span>' <span class="id">c</span>) <span class="kwd">as</span> [<span class="id">f</span> <span class="id">M</span>]; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#union_subset_4">ISProp.union_subset_4</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.Optim.html#union_subset_5">ISProp.union_subset_5</a></span>. <span class="id">auto</span>.<br/>
Defined.</div>
<br/>
<div class="doc">Finalement, nous obtenons la fonction d'analyse voulue, mais non
    sans peine! </div>
<br/>
<span class="kwd">Definition</span> <span class="id">live</span>'' (<span class="id">c</span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span>) (<span class="id">CONT</span>: <span class="id"><a href="CDF.Optim.html#Subset">IdentSet.Subset</a></span> (<span class="id"><a href="CDF.Optim.html#fv_com">fv_com</a></span> <span class="id">c</span>) <span class="id"><a href="CDF.Optim.html#FIXPOINT_FINITE_SETS.U">U</a></span>) (<span class="id">L</span>: <span class="id"><a href="CDF.Optim.html#finset">finset</a></span>) : <span class="id"><a href="CDF.Optim.html#finset">finset</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id">live</span>' <span class="id">c</span> <span class="id">CONT</span>) <span class="id">L</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.Optim.html#FIXPOINT_FINITE_SETS">FIXPOINT_FINITE_SETS</a></span>.<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
