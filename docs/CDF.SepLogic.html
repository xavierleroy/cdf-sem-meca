
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module SepLogic</title>
<meta name="description" content="Documentation of Coq module SepLogic" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module SepLogic</h1>
<div class="coq">
<span class="id">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.ZArith.html">ZArith</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.micromega.Psatz.html">Psatz</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html">Bool</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html">String</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html">List</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Wellfounded.Wellfounded.html">Wellfounded</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Program.Equality.html">Program.Equality</a></span>.<br/>
<span class="id">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html">FunctionalExtensionality</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.PropExtensionality.html">PropExtensionality</a></span>.<br/>
<span class="id">From</span> <span class="id">CDF</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="CDF.IMP.html">IMP</a></span> <span class="id"><a href="CDF.Sequences.html">Sequences</a></span>.<br/>
<br/>
<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">string_scope</span>.<br/>
<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">Z_scope</span>.<br/>
<br/>
<h1> 4.  Logiques de programmes: logique de séparation </h1>
<br/>
<h2> 4.9.  Les tas mémoire (heaps) </h2>
<br/>
<div class="doc">Un tas mémoire est une fonction partielle des adresses dans les
    valeurs, à domaine fini. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="addr">addr</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>.<br/>
<br/>
<span class="kwd">Record</span> <span class="id"><a name="heap">heap</a></span> : <span class="kwd">Type</span> := {<br/>
&nbsp;&nbsp;<span class="id"><a name="contents">contents</a></span> :&gt; <span class="id"><a href="CDF.SepLogic.html#addr">addr</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>;<br/>
&nbsp;&nbsp;<span class="id"><a name="isfinite">isfinite</a></span> :  <span class="id">exists</span> <span class="id">i</span>, <span class="kwd">forall</span> <span class="id">j</span>, <span class="id"><a href="CDF.SepLogic.html#i">i</a></span> &lt;= <span class="id"><a href="CDF.SepLogic.html#j">j</a></span> -&gt; <span class="id"><a href="CDF.SepLogic.html#contents">contents</a></span> <span class="id"><a href="CDF.SepLogic.html#j">j</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
}.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="heap_extensionality">heap_extensionality</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">h1</span> <span class="id">h2</span>: <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span>),<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">l</span>, <span class="id"><a href="CDF.SepLogic.html#h1">h1</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> = <span class="id"><a href="CDF.SepLogic.html#h2">h2</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span>) -&gt; <span class="id"><a href="CDF.SepLogic.html#h1">h1</a></span> = <span class="id"><a href="CDF.SepLogic.html#h2">h2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof162')">Proof.</div>
<div class="proofscript" id="proof162">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">h1</span> <span class="kwd">as</span> [<span class="id">c1</span> <span class="id">fin1</span>], <span class="id">h2</span> <span class="kwd">as</span> [<span class="id">c2</span> <span class="id">fin2</span>].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">c1</span> = <span class="id">c2</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html#functional_extensionality">functional_extensionality</a></span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">c2</span>. <span class="tactic">f_equal</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.PropExtensionality.html#proof_irrelevance">proof_irrelevance</a></span>.<br/>
Qed.</div>
<br/>
<div class="doc">Le tas vide. </div>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="hempty">hempty</a></span> : <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span> :=<br/>
&nbsp;&nbsp;{| <span class="id"><a href="CDF.SepLogic.html#Build_heap">contents</a></span> := <span class="kwd">fun</span> <span class="id">l</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof163')">Next Obligation.</div>
<div class="proofscript" id="proof163">
&nbsp;&nbsp;<span class="id">exists</span> 0; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Le tas qui contient <span class="bracket"><span class="id">v</span></span> à l'adresse <span class="bracket"><span class="id">l</span></span> est est égal à <span class="bracket"><span class="id">h</span></span> ailleurs. </div>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="hupdate">hupdate</a></span> (<span class="id">l</span>: <span class="id"><a href="CDF.SepLogic.html#addr">addr</a></span>) (<span class="id">v</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">h</span>: <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span>) : <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span> :=<br/>
&nbsp;&nbsp;{| <span class="id"><a href="CDF.SepLogic.html#Build_heap">contents</a></span> := <span class="kwd">fun</span> <span class="id">l</span>' =&gt; <span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> <span class="id">l</span>' <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="CDF.SepLogic.html#v">v</a></span> <span class="kwd">else</span> <span class="id"><a href="CDF.SepLogic.html#h">h</a></span> <span class="id">l</span>' |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof164')">Next Obligation.</div>
<div class="proofscript" id="proof164">
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CDF.SepLogic.html#isfinite">isfinite</a></span> <span class="id">h</span>) <span class="kwd">as</span> (<span class="id">i</span> &amp; <span class="id">fin</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.max">Z.max</a></span> <span class="id">i</span> (<span class="id">l</span> + 1)); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">j</span>). <span class="id">lia</span>. <span class="tactic">apply</span> <span class="id">fin</span>; <span class="id">lia</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hupdate_same">hupdate_same</a></span>: <span class="kwd">forall</span> <span class="id">l</span> <span class="id">v</span> <span class="id">h</span>, (<span class="id"><a href="CDF.SepLogic.html#hupdate">hupdate</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> <span class="id"><a href="CDF.SepLogic.html#v">v</a></span> <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>) <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="CDF.SepLogic.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof165')">Proof.</div>
<div class="proofscript" id="proof165">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="id">cbn</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>); <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hupdate_other">hupdate_other</a></span>: <span class="kwd">forall</span> <span class="id">l</span> <span class="id">v</span> <span class="id">h</span> <span class="id">l</span>', <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> &lt;&gt; <span class="id">l</span>' -&gt; (<span class="id"><a href="CDF.SepLogic.html#hupdate">hupdate</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> <span class="id"><a href="CDF.SepLogic.html#v">v</a></span> <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>) <span class="id">l</span>' = <span class="id"><a href="CDF.SepLogic.html#h">h</a></span> <span class="id">l</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof166')">Proof.</div>
<div class="proofscript" id="proof166">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="id">cbn</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>'); <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Le tas <span class="bracket"><span class="id">h</span></span> après désallocation de l'adresse <span class="bracket"><span class="id">l</span></span>. </div>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="hfree">hfree</a></span> (<span class="id">l</span>: <span class="id"><a href="CDF.SepLogic.html#addr">addr</a></span>) (<span class="id">h</span>: <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span>) : <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span> :=<br/>
&nbsp;&nbsp;{| <span class="id"><a href="CDF.SepLogic.html#Build_heap">contents</a></span> := <span class="kwd">fun</span> <span class="id">l</span>' =&gt; <span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> <span class="id">l</span>' <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="kwd">else</span> <span class="id"><a href="CDF.SepLogic.html#h">h</a></span> <span class="id">l</span>' |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof167')">Next Obligation.</div>
<div class="proofscript" id="proof167">
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CDF.SepLogic.html#isfinite">isfinite</a></span> <span class="id">h</span>) <span class="kwd">as</span> (<span class="id">i</span> &amp; <span class="id">fin</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">i</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">j</span>); <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Le tas <span class="bracket"><span class="id">h</span></span> où les adresses <span class="bracket"><span class="id">l</span>, ..., <span class="id">l</span> + <span class="id">sz</span> - 1</span> sont initialisées à 0. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="hinit">hinit</a></span> (<span class="id">l</span>: <span class="id"><a href="CDF.SepLogic.html#addr">addr</a></span>) (<span class="id">sz</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) (<span class="id">h</span>: <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span>) : <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="CDF.SepLogic.html#sz">sz</a></span> <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#O">O</a></span> =&gt; <span class="id"><a href="CDF.SepLogic.html#h">h</a></span> | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">sz</span> =&gt; <span class="id"><a href="CDF.SepLogic.html#hupdate">hupdate</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> 0 (<span class="id"><a href="CDF.SepLogic.html#hinit">hinit</a></span> (<span class="id"><a href="CDF.SepLogic.html#l">l</a></span> + 1) <span class="id"><a href="CDF.SepLogic.html#sz">sz</a></span> <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>) <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hinit_inside">hinit_inside</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h</span> <span class="id">sz</span> <span class="id">l</span> <span class="id">l</span>', <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> &lt;= <span class="id">l</span>' &lt; <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> <span class="id"><a href="CDF.SepLogic.html#sz">sz</a></span> -&gt; <span class="id"><a href="CDF.SepLogic.html#hinit">hinit</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> <span class="id"><a href="CDF.SepLogic.html#sz">sz</a></span> <span class="id"><a href="CDF.SepLogic.html#h">h</a></span> <span class="id">l</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> 0.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof168')">Proof.</div>
<div class="proofscript" id="proof168">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">sz</span>; <span class="tactic">intros</span>; <span class="id">cbn</span>.<br/>
- <span class="id">lia</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>'); <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">IHsz</span>. <span class="id">lia</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hinit_outside">hinit_outside</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h</span> <span class="id">sz</span> <span class="id">l</span> <span class="id">l</span>', <span class="id">l</span>' &lt; <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> \/ <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> <span class="id"><a href="CDF.SepLogic.html#sz">sz</a></span> &lt;= <span class="id">l</span>' -&gt; <span class="id"><a href="CDF.SepLogic.html#hinit">hinit</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> <span class="id"><a href="CDF.SepLogic.html#sz">sz</a></span> <span class="id"><a href="CDF.SepLogic.html#h">h</a></span> <span class="id">l</span>' = <span class="id"><a href="CDF.SepLogic.html#h">h</a></span> <span class="id">l</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof169')">Proof.</div>
<div class="proofscript" id="proof169">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">sz</span>; <span class="tactic">intros</span>; <span class="id">cbn</span>.<br/>
- <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>'). <span class="id">lia</span>. <span class="tactic">apply</span> <span class="id">IHsz</span>; <span class="id">lia</span>.<br/>
Qed.</div>
<br/>
<div class="doc">L'union disjointe de deux tas. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="hdisjoint">hdisjoint</a></span> (<span class="id">h1</span> <span class="id">h2</span>: <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span>, <span class="id"><a href="CDF.SepLogic.html#h1">h1</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> \/ <span class="id"><a href="CDF.SepLogic.html#h2">h2</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hdisjoint_sym">hdisjoint_sym</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h1</span> <span class="id">h2</span>, <span class="id"><a href="CDF.SepLogic.html#hdisjoint">hdisjoint</a></span> <span class="id"><a href="CDF.SepLogic.html#h1">h1</a></span> <span class="id"><a href="CDF.SepLogic.html#h2">h2</a></span> -&gt; <span class="id"><a href="CDF.SepLogic.html#hdisjoint">hdisjoint</a></span> <span class="id"><a href="CDF.SepLogic.html#h2">h2</a></span> <span class="id"><a href="CDF.SepLogic.html#h1">h1</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof170')">Proof.</div>
<div class="proofscript" id="proof170">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CDF.SepLogic.html#hdisjoint">hdisjoint</a></span>; <span class="tactic">intros</span>. <span class="id">specialize</span> (<span class="id">H</span> <span class="id">l</span>); <span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="hunion">hunion</a></span> (<span class="id">h1</span> <span class="id">h2</span>: <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span>) : <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span> :=<br/>
&nbsp;&nbsp;{| <span class="id"><a href="CDF.SepLogic.html#Build_heap">contents</a></span> := <span class="kwd">fun</span> <span class="id">l</span> =&gt; <span class="kwd">if</span> <span class="id"><a href="CDF.SepLogic.html#h1">h1</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> <span class="kwd">then</span> <span class="id"><a href="CDF.SepLogic.html#h1">h1</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> <span class="kwd">else</span> <span class="id"><a href="CDF.SepLogic.html#h2">h2</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof171')">Next Obligation.</div>
<div class="proofscript" id="proof171">
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CDF.SepLogic.html#isfinite">isfinite</a></span> <span class="id">h1</span>) <span class="kwd">as</span> (<span class="id">i1</span> &amp; <span class="id">fin1</span>), (<span class="id"><a href="CDF.SepLogic.html#isfinite">isfinite</a></span> <span class="id">h2</span>) <span class="kwd">as</span> (<span class="id">i2</span> &amp; <span class="id">fin2</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.max">Z.max</a></span> <span class="id">i1</span> <span class="id">i2</span>); <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">fin1</span>, <span class="id">fin2</span> <span class="tactic">by</span> <span class="id">lia</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hunion_comm">hunion_comm</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h1</span> <span class="id">h2</span>, <span class="id"><a href="CDF.SepLogic.html#hdisjoint">hdisjoint</a></span> <span class="id"><a href="CDF.SepLogic.html#h1">h1</a></span> <span class="id"><a href="CDF.SepLogic.html#h2">h2</a></span> -&gt; <span class="id"><a href="CDF.SepLogic.html#hunion">hunion</a></span> <span class="id"><a href="CDF.SepLogic.html#h2">h2</a></span> <span class="id"><a href="CDF.SepLogic.html#h1">h1</a></span> = <span class="id"><a href="CDF.SepLogic.html#hunion">hunion</a></span> <span class="id"><a href="CDF.SepLogic.html#h1">h1</a></span> <span class="id"><a href="CDF.SepLogic.html#h2">h2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof172')">Proof.</div>
<div class="proofscript" id="proof172">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#heap_extensionality">heap_extensionality</a></span>; <span class="tactic">intros</span>; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">l</span>). <span class="tactic">destruct</span> (<span class="id">h1</span> <span class="id">l</span>), (<span class="id">h2</span> <span class="id">l</span>); <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hunion_assoc">hunion_assoc</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">h3</span>, <span class="id"><a href="CDF.SepLogic.html#hunion">hunion</a></span> (<span class="id"><a href="CDF.SepLogic.html#hunion">hunion</a></span> <span class="id"><a href="CDF.SepLogic.html#h1">h1</a></span> <span class="id"><a href="CDF.SepLogic.html#h2">h2</a></span>) <span class="id"><a href="CDF.SepLogic.html#h3">h3</a></span> = <span class="id"><a href="CDF.SepLogic.html#hunion">hunion</a></span> <span class="id"><a href="CDF.SepLogic.html#h1">h1</a></span> (<span class="id"><a href="CDF.SepLogic.html#hunion">hunion</a></span> <span class="id"><a href="CDF.SepLogic.html#h2">h2</a></span> <span class="id"><a href="CDF.SepLogic.html#h3">h3</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof173')">Proof.</div>
<div class="proofscript" id="proof173">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#heap_extensionality">heap_extensionality</a></span>; <span class="tactic">intros</span>; <span class="id">cbn</span>. <span class="tactic">destruct</span> (<span class="id">h1</span> <span class="id">l</span>); <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hunion_empty">hunion_empty</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h</span>, <span class="id"><a href="CDF.SepLogic.html#hunion">hunion</a></span> <span class="id"><a href="CDF.SepLogic.html#hempty">hempty</a></span> <span class="id"><a href="CDF.SepLogic.html#h">h</a></span> = <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof174')">Proof.</div>
<div class="proofscript" id="proof174">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#heap_extensionality">heap_extensionality</a></span>; <span class="tactic">intros</span>; <span class="id">cbn</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<h2> 4.10.  Le langage IMP avec pointeurs et allocation dynamique </h2>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="com">com</a></span>: <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="SKIP">SKIP</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="ASSIGN">ASSIGN</a></span> (<span class="id">x</span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span>) (<span class="id">a</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="SEQ">SEQ</a></span> (<span class="id">c1</span>: <span class="id"><a href="CDF.SepLogic.html#com">com</a></span>) (<span class="id">c2</span>: <span class="id"><a href="CDF.SepLogic.html#com">com</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="IFTHENELSE">IFTHENELSE</a></span> (<span class="id">b</span>: <span class="id"><a href="CDF.IMP.html#bexp">bexp</a></span>) (<span class="id">c1</span>: <span class="id"><a href="CDF.SepLogic.html#com">com</a></span>) (<span class="id">c2</span>: <span class="id"><a href="CDF.SepLogic.html#com">com</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="WHILE">WHILE</a></span> (<span class="id">b</span>: <span class="id"><a href="CDF.IMP.html#bexp">bexp</a></span>) (<span class="id">c1</span>: <span class="id"><a href="CDF.SepLogic.html#com">com</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="ALLOC">ALLOC</a></span> (<span class="id">x</span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span>) (<span class="id">sz</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)  <span class="docright">(* allocation de <span class="bracket"><span class="id">sz</span></span> mots consécutifs  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="GET">GET</a></span> (<span class="id">x</span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span>) (<span class="id">a</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>)    <span class="docright">(* lecture à l'adresse <span class="bracket"><span class="id">a</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="SET">SET</a></span> (<span class="id">a1</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>) (<span class="id">a2</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>)   <span class="docright">(* écriture de <span class="bracket"><span class="id">a2</span></span> à l'adresse <span class="bracket"><span class="id">a1</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="FREE">FREE</a></span> (<span class="id">a</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>).             <span class="docright">(* désallocation de l'adresse <span class="bracket"><span class="id">a</span></span>  *)</span><br/>
<br/>
<div class="doc">La sémantique à réduction.  Elle opère sur des triplets <span class="bracket">(<span class="id">c</span>, <span class="id">s</span>, <span class="id">h</span>)</span>,
    où <span class="bracket"><span class="id">c</span></span> est une commande et <span class="bracket">(<span class="id">s</span>, <span class="id">h</span>)</span> l'état mémoire courant. </div>
<br/>
<div class="doc">Les 6 premières règles sont celles de IMP.  Le tas <span class="bracket"><span class="id">h</span></span> est inchangé.
    Les 4 dernières règles donnent la sémantique des opérations sur le tas:
    <span class="bracket"><span class="id">ALLOC</span></span>, <span class="bracket"><span class="id">GET</span></span>, <span class="bracket"><span class="id">SET</span></span>, <span class="bracket"><span class="id">FREE</span></span>.
</div>
<br/>
<span class="kwd">Inductive</span> <span class="tactic">red</span>: <span class="id"><a href="CDF.SepLogic.html#com">com</a></span> * <span class="id"><a href="CDF.IMP.html#store">store</a></span> * <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span> -&gt; <span class="id"><a href="CDF.SepLogic.html#com">com</a></span> * <span class="id"><a href="CDF.IMP.html#store">store</a></span> * <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_assign">red_assign</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span> <span class="id">s</span> <span class="id">h</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> (<span class="id"><a href="CDF.SepLogic.html#ASSIGN">ASSIGN</a></span> <span class="id"><a href="CDF.SepLogic.html#x">x</a></span> <span class="id"><a href="CDF.SepLogic.html#a">a</a></span>, <span class="id"><a href="CDF.SepLogic.html#s">s</a></span>, <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>) (<span class="id"><a href="CDF.SepLogic.html#SKIP">SKIP</a></span>, <span class="id"><a href="CDF.IMP.html#update">update</a></span> <span class="id"><a href="CDF.SepLogic.html#x">x</a></span> (<span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id"><a href="CDF.SepLogic.html#a">a</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span>) <span class="id"><a href="CDF.SepLogic.html#s">s</a></span>, <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_seq_done">red_seq_done</a></span>: <span class="kwd">forall</span> <span class="id">c</span> <span class="id">s</span> <span class="id">h</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> (<span class="id"><a href="CDF.SepLogic.html#SEQ">SEQ</a></span> <span class="id"><a href="CDF.SepLogic.html#SKIP">SKIP</a></span> <span class="id"><a href="CDF.SepLogic.html#c">c</a></span>, <span class="id"><a href="CDF.SepLogic.html#s">s</a></span>, <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>) (<span class="id"><a href="CDF.SepLogic.html#c">c</a></span>, <span class="id"><a href="CDF.SepLogic.html#s">s</a></span>, <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_seq_step">red_seq_step</a></span>: <span class="kwd">forall</span> <span class="id">c1</span> <span class="id">c</span> <span class="id">s1</span> <span class="id">h1</span> <span class="id">c2</span> <span class="id">s2</span> <span class="id">h2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> (<span class="id"><a href="CDF.SepLogic.html#c1">c1</a></span>, <span class="id"><a href="CDF.SepLogic.html#s1">s1</a></span>, <span class="id"><a href="CDF.SepLogic.html#h1">h1</a></span>) (<span class="id"><a href="CDF.SepLogic.html#c2">c2</a></span>, <span class="id"><a href="CDF.SepLogic.html#s2">s2</a></span>, <span class="id"><a href="CDF.SepLogic.html#h2">h2</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> (<span class="id"><a href="CDF.SepLogic.html#SEQ">SEQ</a></span> <span class="id"><a href="CDF.SepLogic.html#c1">c1</a></span> <span class="id"><a href="CDF.SepLogic.html#c">c</a></span>, <span class="id"><a href="CDF.SepLogic.html#s1">s1</a></span>, <span class="id"><a href="CDF.SepLogic.html#h1">h1</a></span>) (<span class="id"><a href="CDF.SepLogic.html#SEQ">SEQ</a></span> <span class="id"><a href="CDF.SepLogic.html#c2">c2</a></span> <span class="id"><a href="CDF.SepLogic.html#c">c</a></span>, <span class="id"><a href="CDF.SepLogic.html#s2">s2</a></span>, <span class="id"><a href="CDF.SepLogic.html#h2">h2</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_ifthenelse">red_ifthenelse</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">s</span> <span class="id">h</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> (<span class="id"><a href="CDF.SepLogic.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id"><a href="CDF.SepLogic.html#b">b</a></span> <span class="id"><a href="CDF.SepLogic.html#c1">c1</a></span> <span class="id"><a href="CDF.SepLogic.html#c2">c2</a></span>, <span class="id"><a href="CDF.SepLogic.html#s">s</a></span>, <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>) ((<span class="kwd">if</span> <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id"><a href="CDF.SepLogic.html#b">b</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span> <span class="kwd">then</span> <span class="id"><a href="CDF.SepLogic.html#c1">c1</a></span> <span class="kwd">else</span> <span class="id"><a href="CDF.SepLogic.html#c2">c2</a></span>), <span class="id"><a href="CDF.SepLogic.html#s">s</a></span>, <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_while_done">red_while_done</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c</span> <span class="id">s</span> <span class="id">h</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id"><a href="CDF.SepLogic.html#b">b</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> (<span class="id"><a href="CDF.SepLogic.html#WHILE">WHILE</a></span> <span class="id"><a href="CDF.SepLogic.html#b">b</a></span> <span class="id"><a href="CDF.SepLogic.html#c">c</a></span>, <span class="id"><a href="CDF.SepLogic.html#s">s</a></span>, <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>) (<span class="id"><a href="CDF.SepLogic.html#SKIP">SKIP</a></span>, <span class="id"><a href="CDF.SepLogic.html#s">s</a></span>, <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_while_loop">red_while_loop</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c</span> <span class="id">s</span> <span class="id">h</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id"><a href="CDF.SepLogic.html#b">b</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> (<span class="id"><a href="CDF.SepLogic.html#WHILE">WHILE</a></span> <span class="id"><a href="CDF.SepLogic.html#b">b</a></span> <span class="id"><a href="CDF.SepLogic.html#c">c</a></span>, <span class="id"><a href="CDF.SepLogic.html#s">s</a></span>, <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>) (<span class="id"><a href="CDF.SepLogic.html#SEQ">SEQ</a></span> <span class="id"><a href="CDF.SepLogic.html#c">c</a></span> (<span class="id"><a href="CDF.SepLogic.html#WHILE">WHILE</a></span> <span class="id"><a href="CDF.SepLogic.html#b">b</a></span> <span class="id"><a href="CDF.SepLogic.html#c">c</a></span>), <span class="id"><a href="CDF.SepLogic.html#s">s</a></span>, <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_alloc">red_alloc</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">sz</span> <span class="id">s</span> (<span class="id">h</span>: <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span>) <span class="id">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">i</span>, <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> &lt;= <span class="id"><a href="CDF.SepLogic.html#i">i</a></span> &lt; <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> <span class="id"><a href="CDF.SepLogic.html#sz">sz</a></span> -&gt; <span class="id"><a href="CDF.SepLogic.html#h">h</a></span> <span class="id"><a href="CDF.SepLogic.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#l">l</a></span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> (<span class="id"><a href="CDF.SepLogic.html#ALLOC">ALLOC</a></span> <span class="id"><a href="CDF.SepLogic.html#x">x</a></span> <span class="id"><a href="CDF.SepLogic.html#sz">sz</a></span>, <span class="id"><a href="CDF.SepLogic.html#s">s</a></span>, <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>) (<span class="id"><a href="CDF.SepLogic.html#SKIP">SKIP</a></span>, <span class="id"><a href="CDF.IMP.html#update">update</a></span> <span class="id"><a href="CDF.SepLogic.html#x">x</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span>, <span class="id"><a href="CDF.SepLogic.html#hinit">hinit</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> <span class="id"><a href="CDF.SepLogic.html#sz">sz</a></span> <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_get">red_get</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span> <span class="id">s</span> (<span class="id">h</span>: <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span>) <span class="id">l</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#l">l</a></span> = <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id"><a href="CDF.SepLogic.html#a">a</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span> -&gt; <span class="id"><a href="CDF.SepLogic.html#h">h</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="CDF.SepLogic.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> (<span class="id"><a href="CDF.SepLogic.html#GET">GET</a></span> <span class="id"><a href="CDF.SepLogic.html#x">x</a></span> <span class="id"><a href="CDF.SepLogic.html#a">a</a></span>, <span class="id"><a href="CDF.SepLogic.html#s">s</a></span>, <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>) (<span class="id"><a href="CDF.SepLogic.html#SKIP">SKIP</a></span>, <span class="id"><a href="CDF.IMP.html#update">update</a></span> <span class="id"><a href="CDF.SepLogic.html#x">x</a></span> <span class="id"><a href="CDF.SepLogic.html#v">v</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span>, <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_set">red_set</a></span>: <span class="kwd">forall</span> <span class="id">a1</span> <span class="id">a2</span> <span class="id">s</span> (<span class="id">h</span>: <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span>) <span class="id">l</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#l">l</a></span> = <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id"><a href="CDF.SepLogic.html#a1">a1</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span> -&gt; <span class="id"><a href="CDF.SepLogic.html#h">h</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt; <span class="id"><a href="CDF.SepLogic.html#v">v</a></span> = <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id"><a href="CDF.SepLogic.html#a2">a2</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> (<span class="id"><a href="CDF.SepLogic.html#SET">SET</a></span> <span class="id"><a href="CDF.SepLogic.html#a1">a1</a></span> <span class="id"><a href="CDF.SepLogic.html#a2">a2</a></span>, <span class="id"><a href="CDF.SepLogic.html#s">s</a></span>, <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>) (<span class="id"><a href="CDF.SepLogic.html#SKIP">SKIP</a></span>, <span class="id"><a href="CDF.SepLogic.html#s">s</a></span>, <span class="id"><a href="CDF.SepLogic.html#hupdate">hupdate</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> <span class="id"><a href="CDF.SepLogic.html#v">v</a></span> <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_free">red_free</a></span>: <span class="kwd">forall</span> <span class="id">a</span> <span class="id">s</span> (<span class="id">h</span>: <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span>) <span class="id">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#l">l</a></span> = <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id"><a href="CDF.SepLogic.html#a">a</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span> -&gt; <span class="id"><a href="CDF.SepLogic.html#h">h</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> (<span class="id"><a href="CDF.SepLogic.html#FREE">FREE</a></span> <span class="id"><a href="CDF.SepLogic.html#a">a</a></span>, <span class="id"><a href="CDF.SepLogic.html#s">s</a></span>, <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>) (<span class="id"><a href="CDF.SepLogic.html#SKIP">SKIP</a></span>, <span class="id"><a href="CDF.SepLogic.html#s">s</a></span>, <span class="id"><a href="CDF.SepLogic.html#hfree">hfree</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>).<br/>
<br/>
<div class="doc">Les variables possiblement modifiées par l'exécution d'une commande. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="modified_by">modified_by</a></span> (<span class="id">c</span>: <span class="id"><a href="CDF.SepLogic.html#com">com</a></span>) (<span class="id">x</span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="CDF.SepLogic.html#c">c</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.SepLogic.html#SKIP">SKIP</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.SepLogic.html#ASSIGN">ASSIGN</a></span> <span class="id">y</span> <span class="id">a</span> =&gt; <span class="id"><a href="CDF.SepLogic.html#x">x</a></span> = <span class="id">y</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.SepLogic.html#SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id"><a href="CDF.SepLogic.html#modified_by">modified_by</a></span> <span class="id">c1</span> <span class="id"><a href="CDF.SepLogic.html#x">x</a></span> \/ <span class="id"><a href="CDF.SepLogic.html#modified_by">modified_by</a></span> <span class="id">c2</span> <span class="id"><a href="CDF.SepLogic.html#x">x</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.SepLogic.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id"><a href="CDF.SepLogic.html#modified_by">modified_by</a></span> <span class="id">c1</span> <span class="id"><a href="CDF.SepLogic.html#x">x</a></span> \/ <span class="id"><a href="CDF.SepLogic.html#modified_by">modified_by</a></span> <span class="id">c2</span> <span class="id"><a href="CDF.SepLogic.html#x">x</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.SepLogic.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c1</span> =&gt; <span class="id"><a href="CDF.SepLogic.html#modified_by">modified_by</a></span> <span class="id">c1</span> <span class="id"><a href="CDF.SepLogic.html#x">x</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.SepLogic.html#ALLOC">ALLOC</a></span> <span class="id">y</span> <span class="id">sz</span> =&gt; <span class="id"><a href="CDF.SepLogic.html#x">x</a></span> = <span class="id">y</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.SepLogic.html#GET">GET</a></span> <span class="id">y</span> <span class="id">a</span> =&gt; <span class="id"><a href="CDF.SepLogic.html#x">x</a></span> = <span class="id">y</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.SepLogic.html#SET">SET</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.SepLogic.html#FREE">FREE</a></span> <span class="id">a</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<h2> 4.11.  Les assertions de la logique de séparation </h2>
<br/>
<div class="doc">Les assertions sont des prédicats sur les deux composantes de
    l'état mémoire. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="assertion">assertion</a></span> : <span class="kwd">Type</span> := <span class="id"><a href="CDF.IMP.html#store">store</a></span> -&gt; <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span> -&gt; <span class="kwd">Prop</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="aexists">aexists</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">P</span>: <span class="id"><a href="CDF.SepLogic.html#A">A</a></span> -&gt; <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>) : <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> <span class="id">h</span> =&gt; <span class="id">exists</span> <span class="id">a</span>: <span class="id"><a href="CDF.SepLogic.html#A">A</a></span>, <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> <span class="id"><a href="CDF.SepLogic.html#a">a</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span> <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>.<br/>
<br/>
<div class="doc">L'assertion "le tas est vide" </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="emp">emp</a></span> : <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> <span class="id">h</span> =&gt; <span class="id"><a href="CDF.SepLogic.html#h">h</a></span> = <span class="id"><a href="CDF.SepLogic.html#hempty">hempty</a></span>.<br/>
<br/>
<div class="doc">L'assertion "l'adresse <span class="bracket"><span class="id">l</span></span> contient la valeur <span class="bracket"><span class="id">v</span></span>". 
    Le domaine du tas doit être le singleton <span class="bracket">{<span class="id">l</span>}</span>. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="contains">contains</a></span> (<span class="id">l</span>: <span class="id"><a href="CDF.SepLogic.html#addr">addr</a></span>) (<span class="id">v</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> <span class="id">h</span> =&gt; <span class="id"><a href="CDF.SepLogic.html#h">h</a></span> = <span class="id"><a href="CDF.SepLogic.html#hupdate">hupdate</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> <span class="id"><a href="CDF.SepLogic.html#v">v</a></span> <span class="id"><a href="CDF.SepLogic.html#hempty">hempty</a></span>.<br/>
<br/>
<div class="doc">L'assertion "l'adresse <span class="bracket"><span class="id">l</span></span> est valide". </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="valid">valid</a></span> (<span class="id">l</span>: <span class="id"><a href="CDF.SepLogic.html#addr">addr</a></span>) : <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span> := <span class="id"><a href="CDF.SepLogic.html#aexists">aexists</a></span> (<span class="id"><a href="CDF.SepLogic.html#contains">contains</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span>).<br/>
<br/>
<div class="doc">La conjonction séparante. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="sepconj">sepconj</a></span> (<span class="id">P</span> <span class="id">Q</span>: <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>) : <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> <span class="id">h</span> =&gt; <span class="id">exists</span> <span class="id">h1</span> <span class="id">h2</span>, <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span> <span class="id"><a href="CDF.SepLogic.html#h1">h1</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span> <span class="id"><a href="CDF.SepLogic.html#h2">h2</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="CDF.SepLogic.html#hdisjoint">hdisjoint</a></span> <span class="id"><a href="CDF.SepLogic.html#h1">h1</a></span> <span class="id"><a href="CDF.SepLogic.html#h2">h2</a></span>  /\ <span class="id"><a href="CDF.SepLogic.html#h">h</a></span> = <span class="id"><a href="CDF.SepLogic.html#hunion">hunion</a></span> <span class="id"><a href="CDF.SepLogic.html#h1">h1</a></span> <span class="id"><a href="CDF.SepLogic.html#h2">h2</a></span>.<br/>
<br/>
<span class="kwd">Notation</span> "<span class="id">P</span> ** <span class="id">Q</span>" := (<span class="id"><a href="CDF.SepLogic.html#sepconj">sepconj</a></span> <span class="id">P</span> <span class="id">Q</span>) (<span class="tactic">at</span> <span class="id">level</span> 60, <span class="id">right</span> <span class="id">associativity</span>).<br/>
<br/>
<div class="doc">On utilise aussi des assertions simples, qui ne dépendent pas du tas
    mais seulement de l'état mémoire.  Ce sont les mêmes assertions
    que celles de la logique de Hoare. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="simple_assertion">simple_assertion</a></span> : <span class="kwd">Type</span> := <span class="id"><a href="CDF.IMP.html#store">store</a></span> -&gt; <span class="kwd">Prop</span>.<br/>
<br/>
<div class="doc">L'assertion "l'expression arithmétique <span class="bracket"><span class="id">a</span></span> s'évalue en la valeur <span class="bracket"><span class="id">v</span></span>". </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="aequal">aequal</a></span> (<span class="id">a</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>) (<span class="id">v</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="CDF.SepLogic.html#simple_assertion">simple_assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id"><a href="CDF.SepLogic.html#a">a</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span> = <span class="id"><a href="CDF.SepLogic.html#v">v</a></span>.<br/>
<br/>
<div class="doc">Les assertions "l'expression booléenne <span class="bracket"><span class="id">b</span></span> s'évalue à vrai / à faux". </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="atrue">atrue</a></span> (<span class="id">b</span>: <span class="id"><a href="CDF.IMP.html#bexp">bexp</a></span>) : <span class="id"><a href="CDF.SepLogic.html#simple_assertion">simple_assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id"><a href="CDF.SepLogic.html#b">b</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="afalse">afalse</a></span> (<span class="id">b</span>: <span class="id"><a href="CDF.IMP.html#bexp">bexp</a></span>) : <span class="id"><a href="CDF.SepLogic.html#simple_assertion">simple_assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id"><a href="CDF.SepLogic.html#b">b</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<br/>
<div class="doc">La conjonction d'une assertion pure et d'une assertion générale. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="pureconj">pureconj</a></span> (<span class="id">P</span>: <span class="id"><a href="CDF.SepLogic.html#simple_assertion">simple_assertion</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>) : <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> <span class="id">h</span> =&gt; <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span> /\ <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span> <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>.<br/>
<br/>
<span class="kwd">Notation</span> "<span class="id">P</span> //\\ <span class="id">Q</span>" := (<span class="id"><a href="CDF.SepLogic.html#pureconj">pureconj</a></span> <span class="id">P</span> <span class="id">Q</span>) (<span class="tactic">at</span> <span class="id">level</span> 60, <span class="id">right</span> <span class="id">associativity</span>).<br/>
<br/>
<div class="doc">L'égalité extensionnelle entre assertions. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="assertion_extensionality">assertion_extensionality</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">P</span> <span class="id">Q</span>: <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>),<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">s</span> <span class="id">h</span>, <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span> <span class="id"><a href="CDF.SepLogic.html#h">h</a></span> &lt;-&gt; <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span> <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>) -&gt; <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> = <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof175')">Proof.</div>
<div class="proofscript" id="proof175">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html#functional_extensionality">functional_extensionality</a></span>; <span class="tactic">intros</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html#functional_extensionality">functional_extensionality</a></span>; <span class="tactic">intros</span> <span class="id">h</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.PropExtensionality.html#propositional_extensionality">propositional_extensionality</a></span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Les propriétés essentielles de la conjonction séparante. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sepconj_comm">sepconj_comm</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span>, <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> ** <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span> = <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span> ** <span class="id"><a href="CDF.SepLogic.html#P">P</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof176')">Proof.</div>
<div class="proofscript" id="proof176">
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">s</span> <span class="id">h</span>, (<span class="id"><a href="CDF.SepLogic.html#P">P</a></span> ** <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span>) <span class="id"><a href="CDF.SepLogic.html#s">s</a></span> <span class="id"><a href="CDF.SepLogic.html#h">h</a></span> -&gt; (<span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span> ** <span class="id"><a href="CDF.SepLogic.html#P">P</a></span>) <span class="id"><a href="CDF.SepLogic.html#s">s</a></span> <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">s</span> <span class="id">h</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">P1</span> &amp; <span class="id">Q2</span> &amp; <span class="id">EQ</span> &amp; <span class="id">DISJ</span>); <span class="tactic">subst</span> <span class="id">h</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">h2</span>, <span class="id">h1</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#hdisjoint_sym">hdisjoint_sym</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#hunion_comm">hunion_comm</a></span>; <span class="tactic">auto</span>. } <br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#assertion_extensionality">assertion_extensionality</a></span>; <span class="tactic">intros</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sepconj_assoc">sepconj_assoc</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">R</span>, (<span class="id"><a href="CDF.SepLogic.html#P">P</a></span> ** <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span>) ** <span class="id"><a href="CDF.SepLogic.html#R">R</a></span> = <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> ** (<span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span> ** <span class="id"><a href="CDF.SepLogic.html#R">R</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof177')">Proof.</div>
<div class="proofscript" id="proof177">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#assertion_extensionality">assertion_extensionality</a></span>; <span class="tactic">intros</span>; <span class="tactic">split</span>.<br/>
- <span class="tactic">intros</span> (<span class="id">hx</span> &amp; <span class="id">h3</span> &amp; (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">P1</span> &amp; <span class="id">Q2</span> &amp; <span class="id">EQ</span> &amp; <span class="id">DISJ</span>) &amp; <span class="id">R3</span> &amp; <span class="id">EQ</span>' &amp; <span class="id">DISJ</span>'). <span class="tactic">subst</span> <span class="id">hx</span> <span class="id">h</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CDF.SepLogic.html#hunion_assoc">hunion_assoc</a></span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">h1</span>, (<span class="id"><a href="CDF.SepLogic.html#hunion">hunion</a></span> <span class="id">h2</span> <span class="id">h3</span>); <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">h2</span>, <span class="id">h3</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">l</span>. <span class="id">specialize</span> (<span class="id">EQ</span> <span class="id">l</span>); <span class="id">specialize</span> (<span class="id">EQ</span>' <span class="id">l</span>). <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">EQ</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">EQ</span> <span class="kwd">as</span> [<span class="id">EQ</span>|<span class="id">EQ</span>]. <span class="tactic">rewrite</span> <span class="id">EQ</span> <span class="kwd">in</span> <span class="id">EQ</span>'; <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">l</span>. <span class="id">specialize</span> (<span class="id">EQ</span> <span class="id">l</span>); <span class="id">specialize</span> (<span class="id">EQ</span>' <span class="id">l</span>). <span class="id">cbn</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">EQ</span> <span class="kwd">as</span> [<span class="id">EQ</span>|<span class="id">EQ</span>]. <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">EQ</span> <span class="kwd">in</span> *. <span class="tactic">destruct</span> (<span class="id">h1</span> <span class="id">l</span>); <span class="tactic">auto</span>.<br/>
- <span class="tactic">intros</span> (<span class="id">h1</span> &amp; <span class="id">hx</span> &amp; <span class="id">P1</span> &amp; (<span class="id">h2</span> &amp; <span class="id">h3</span> &amp; <span class="id">Q2</span> &amp; <span class="id">R3</span> &amp; <span class="id">EQ</span> &amp; <span class="id">DISJ</span>) &amp; <span class="id">EQ</span>' &amp; <span class="id">DISJ</span>'). <span class="tactic">subst</span> <span class="id">hx</span> <span class="id">h</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="CDF.SepLogic.html#hunion_assoc">hunion_assoc</a></span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CDF.SepLogic.html#hunion">hunion</a></span> <span class="id">h1</span> <span class="id">h2</span>), <span class="id">h3</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">h1</span>, <span class="id">h2</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">l</span>. <span class="id">specialize</span> (<span class="id">EQ</span> <span class="id">l</span>); <span class="id">specialize</span> (<span class="id">EQ</span>' <span class="id">l</span>). <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">EQ</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">EQ</span>' <span class="kwd">as</span> [<span class="id">EQ</span>'|<span class="id">EQ</span>']. <span class="tactic">auto</span>. <span class="tactic">destruct</span> (<span class="id">h2</span> <span class="id">l</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">l</span>. <span class="id">specialize</span> (<span class="id">EQ</span> <span class="id">l</span>); <span class="id">specialize</span> (<span class="id">EQ</span>' <span class="id">l</span>). <span class="id">cbn</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">EQ</span> <span class="kwd">as</span> [<span class="id">EQ</span>|<span class="id">EQ</span>]. <span class="tactic">rewrite</span> <span class="id">EQ</span> <span class="kwd">in</span> *. <span class="tactic">destruct</span> (<span class="id">h1</span> <span class="id">l</span>); <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sepconj_emp">sepconj_emp</a></span>: <span class="kwd">forall</span> <span class="id">P</span>, <span class="id"><a href="CDF.SepLogic.html#emp">emp</a></span> ** <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> = <span class="id"><a href="CDF.SepLogic.html#P">P</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof178')">Proof.</div>
<div class="proofscript" id="proof178">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#assertion_extensionality">assertion_extensionality</a></span>; <span class="tactic">intros</span>; <span class="tactic">split</span>.<br/>
- <span class="tactic">intros</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">EMP1</span> &amp; <span class="id">P2</span> &amp; <span class="id">EQ</span> &amp; <span class="id">DISJ</span>). <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">EMP1</span>. <span class="tactic">subst</span> <span class="id">h</span> <span class="id">h1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CDF.SepLogic.html#hunion_empty">hunion_empty</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">intros</span>. <span class="id">exists</span> <span class="id"><a href="CDF.SepLogic.html#hempty">hempty</a></span>, <span class="id">h</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CDF.SepLogic.html#hunion_empty">hunion_empty</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lift_aexists">lift_aexists</a></span>: <span class="kwd">forall</span> (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">P</span>: <span class="id"><a href="CDF.SepLogic.html#A">A</a></span> -&gt; <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>) <span class="id">Q</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#aexists">aexists</a></span> <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> ** <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span> = <span class="id"><a href="CDF.SepLogic.html#aexists">aexists</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> <span class="id"><a href="CDF.SepLogic.html#x">x</a></span> ** <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof179')">Proof.</div>
<div class="proofscript" id="proof179">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#assertion_extensionality">assertion_extensionality</a></span>; <span class="tactic">intros</span>; <span class="tactic">split</span>.<br/>
- <span class="tactic">intros</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; (<span class="id">a</span> &amp; <span class="id">P1</span>) &amp; <span class="id">Q2</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">a</span>, <span class="id">h1</span>, <span class="id">h2</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">intros</span> (<span class="id">a</span> &amp; <span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">P1</span> &amp; <span class="id">Q2</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">h1</span>, <span class="id">h2</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>. <span class="id">exists</span> <span class="id">a</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lift_simple_conj">lift_simple_conj</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">R</span>, (<span class="id"><a href="CDF.SepLogic.html#P">P</a></span> //\\ <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span>) ** <span class="id"><a href="CDF.SepLogic.html#R">R</a></span> = <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> //\\ (<span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span> ** <span class="id"><a href="CDF.SepLogic.html#R">R</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof180')">Proof.</div>
<div class="proofscript" id="proof180">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#assertion_extensionality">assertion_extensionality</a></span>; <span class="tactic">intros</span>; <span class="tactic">split</span>.<br/>
- <span class="tactic">intros</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; (<span class="id">P1</span> &amp; <span class="id">Q1</span>) &amp; <span class="id">R2</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>). <br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="id">exists</span> <span class="id">h1</span>, <span class="id">h2</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">intros</span> (<span class="id">P1</span> &amp; (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">Q1</span> &amp; <span class="id">R2</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>)). <br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">h1</span>, <span class="id">h2</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<h2> 4.12.  Les règles de la logique de séparation. </h2>
<br/>
<div class="doc">Nous voulons définir une logique "forte", qui garantit la terminaison
    sans erreurs des commandes.  Les erreurs possibles sont par exemple
    la lecture ou l'écriture à une adresse mémoire non allouée, ou
    la désallocation d'une adresse déjà désallouée.
    Une définition naturelle du triplet <span class="bracket">[<span class="id">P</span>] <span class="id">c</span> [<span class="id">Q</span>]</span> est la suivante.
</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="triple_base">triple_base</a></span> (<span class="id">P</span>: <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>) (<span class="id">c</span>: <span class="id"><a href="CDF.SepLogic.html#com">com</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">h</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#P">P</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span> <span class="id"><a href="CDF.SepLogic.html#h">h</a></span> -&gt; <span class="id">exists</span> <span class="id">s</span>' <span class="id">h</span>', <span class="id"><a href="CDF.Sequences.html#star">star</a></span> <span class="tactic">red</span> (<span class="id"><a href="CDF.SepLogic.html#c">c</a></span>, <span class="id"><a href="CDF.SepLogic.html#s">s</a></span>, <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>) (<span class="id"><a href="CDF.SepLogic.html#SKIP">SKIP</a></span>, <span class="id">s</span>', <span class="id">h</span>') /\ <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span> <span class="id">s</span>' <span class="id">h</span>'.<br/>
<br/>
<div class="doc">Cette définition ne convient pas, car elle ne valide pas de manière
    évidente la règle d'encadrement (frame rule).
    Par exemple, si <span class="bracket"><span class="id">c</span></span> est une allocation <span class="bracket"><span class="id">x</span> := <span class="id">ALLOC</span>(1)</span>,
    on a bien un triplet
<pre>
       [ emp ]  x := ALLOC(1)  [ aexists (fun l =&gt; aequal (VAR "x") l //\\ valid l ]</pre>
    Cependant, si on encadre avec <span class="bracket"><span class="id">R</span></span>, l'adresse <span class="bracket"><span class="id">l</span></span> de l'allocation
    peut tomber dans l'empreinte mémoire de <span class="bracket"><span class="id">R</span></span>.  Et donc la
    postcondition <span class="bracket"><span class="id">R</span> ** <span class="id">aexists</span> ...</span>  peut être fausse. </div>
<br/>
<div class="doc">Une manière élégante de contourner ce problème est de quantifier
    universellement sur tous les encadrements possibles dans la
    définition même du triplet. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="independent_of">independent_of</a></span> (<span class="id">P</span>: <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>) (<span class="id">vars</span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span> -&gt; <span class="kwd">Prop</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h</span> <span class="id">s1</span> <span class="id">s2</span>,<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, ~ <span class="id"><a href="CDF.SepLogic.html#vars">vars</a></span> <span class="id"><a href="CDF.SepLogic.html#x">x</a></span> -&gt; <span class="id"><a href="CDF.SepLogic.html#s2">s2</a></span> <span class="id"><a href="CDF.SepLogic.html#x">x</a></span> = <span class="id"><a href="CDF.SepLogic.html#s1">s1</a></span> <span class="id"><a href="CDF.SepLogic.html#x">x</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#P">P</a></span> <span class="id"><a href="CDF.SepLogic.html#s1">s1</a></span> <span class="id"><a href="CDF.SepLogic.html#h">h</a></span> -&gt; <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> <span class="id"><a href="CDF.SepLogic.html#s2">s2</a></span> <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="triple">triple</a></span> (<span class="id">P</span>: <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>) (<span class="id">c</span>: <span class="id"><a href="CDF.SepLogic.html#com">com</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">R</span>: <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#independent_of">independent_of</a></span> <span class="id"><a href="CDF.SepLogic.html#R">R</a></span> (<span class="id"><a href="CDF.SepLogic.html#modified_by">modified_by</a></span> <span class="id"><a href="CDF.SepLogic.html#c">c</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#triple_base">triple_base</a></span> (<span class="id"><a href="CDF.SepLogic.html#P">P</a></span> ** <span class="id"><a href="CDF.SepLogic.html#R">R</a></span>) <span class="id"><a href="CDF.SepLogic.html#c">c</a></span> (<span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span> ** <span class="id"><a href="CDF.SepLogic.html#R">R</a></span>).<br/>
<br/>
<div class="doc">La règle d'encadrement est alors valide par construction.
    En revanche, les preuves des autres règles de la logique de séparation
    sont un peu plus difficiles, car elles doivent prendre en compte
    cet encadrement systématique par une assertion <span class="bracket"><span class="id">R</span></span>. </div>
<br/>
<span class="kwd">Notation</span> "[[ <span class="id">P</span> ]] <span class="id">c</span> [[ <span class="id">Q</span> ]]" := (<span class="id"><a href="CDF.SepLogic.html#triple">triple</a></span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span>) (<span class="tactic">at</span> <span class="id">level</span> 90, <span class="id">c</span> <span class="tactic">at</span> <span class="id">next</span> <span class="id">level</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="triple_frame">triple_frame</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span> <span class="id">R</span>,<br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> ]] <span class="id"><a href="CDF.SepLogic.html#c">c</a></span> [[ <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span> ]] -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#independent_of">independent_of</a></span> <span class="id"><a href="CDF.SepLogic.html#R">R</a></span> (<span class="id"><a href="CDF.SepLogic.html#modified_by">modified_by</a></span> <span class="id"><a href="CDF.SepLogic.html#c">c</a></span>) -&gt;<br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> ** <span class="id"><a href="CDF.SepLogic.html#R">R</a></span> ]] <span class="id"><a href="CDF.SepLogic.html#c">c</a></span> [[ <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span> ** <span class="id"><a href="CDF.SepLogic.html#R">R</a></span> ]].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof181')">Proof.</div>
<div class="proofscript" id="proof181">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span> <span class="id">R</span> <span class="id">TR</span> <span class="id">INDR</span> <span class="id">S</span> <span class="id">INDS</span>. <span class="tactic">rewrite</span> ! <span class="id"><a href="CDF.SepLogic.html#sepconj_assoc">sepconj_assoc</a></span>. <span class="tactic">apply</span> <span class="id">TR</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">h</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">SAME</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">R1</span> &amp; <span class="id">S2</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">h1</span>, <span class="id">h2</span>; <span class="tactic">intuition</span> <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Les "petites règles" pour les opérations sur le tas. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="triple_get">triple_get</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span> <span class="id">l</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#aequal">aequal</a></span> <span class="id"><a href="CDF.SepLogic.html#a">a</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> //\\ <span class="id"><a href="CDF.SepLogic.html#contains">contains</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> <span class="id"><a href="CDF.SepLogic.html#v">v</a></span> ]]<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#GET">GET</a></span> <span class="id"><a href="CDF.SepLogic.html#x">x</a></span> <span class="id"><a href="CDF.SepLogic.html#a">a</a></span><br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#aequal">aequal</a></span> (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> <span class="id"><a href="CDF.SepLogic.html#x">x</a></span>) <span class="id"><a href="CDF.SepLogic.html#v">v</a></span> //\\ <span class="id"><a href="CDF.SepLogic.html#contains">contains</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> <span class="id"><a href="CDF.SepLogic.html#v">v</a></span> ]].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof182')">Proof.</div>
<div class="proofscript" id="proof182">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intros</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; (<span class="id">P1</span> &amp; <span class="id">P2</span>) &amp; <span class="id">R1</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>).<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Sequences.html#star_one">star_one</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#red_get">red_get</a></span> <span class="kwd">with</span> (<span class="id">l</span> := <span class="id">l</span>) (<span class="id">v</span> := <span class="id">v</span>); <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">EQ</span>, <span class="id">P2</span>; <span class="id">cbn</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>); <span class="tactic">congruence</span>. <br/>
- <span class="id">exists</span> <span class="id">h1</span>, <span class="id">h2</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">split</span>. <span class="tactic">red</span>; <span class="id">cbn</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.IMP.html#update_same">update_same</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IND</span> <span class="kwd">with</span> <span class="id">s</span>; <span class="tactic">auto</span>. <span class="id">cbn</span>; <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.IMP.html#update_other">update_other</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="triple_set">triple_set</a></span>: <span class="kwd">forall</span> <span class="id">a1</span> <span class="id">a2</span> <span class="id">l</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#aequal">aequal</a></span> <span class="id"><a href="CDF.SepLogic.html#a1">a1</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> //\\ <span class="id"><a href="CDF.SepLogic.html#aequal">aequal</a></span> <span class="id"><a href="CDF.SepLogic.html#a2">a2</a></span> <span class="id"><a href="CDF.SepLogic.html#v">v</a></span> //\\ <span class="id"><a href="CDF.SepLogic.html#valid">valid</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> ]]<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#SET">SET</a></span> <span class="id"><a href="CDF.SepLogic.html#a1">a1</a></span> <span class="id"><a href="CDF.SepLogic.html#a2">a2</a></span><br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#contains">contains</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> <span class="id"><a href="CDF.SepLogic.html#v">v</a></span> ]].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof183')">Proof.</div>
<div class="proofscript" id="proof183">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intros</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; (<span class="id">P1</span> &amp; <span class="id">P2</span> &amp; <span class="id">P3</span>) &amp; <span class="id">R1</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>). <span class="tactic">destruct</span> <span class="id">P3</span> <span class="kwd">as</span> (<span class="id">v0</span> &amp; <span class="id">P3</span>).<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Sequences.html#star_one">star_one</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="CDF.SepLogic.html#red_set">red_set</a></span> <span class="kwd">with</span> (<span class="id">l</span> := <span class="id">l</span>) (<span class="id">v</span> := <span class="id">v</span>); <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">EQ</span>, <span class="id">P3</span>. <span class="id">cbn</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>); <span class="tactic">congruence</span>.<br/>
- <span class="id">exists</span> (<span class="id"><a href="CDF.SepLogic.html#hupdate">hupdate</a></span> <span class="id">l</span> <span class="id">v</span> <span class="id"><a href="CDF.SepLogic.html#hempty">hempty</a></span>), <span class="id">h2</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">red</span>; <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">l</span>'. <span class="id">specialize</span> (<span class="id">DISJ</span> <span class="id">l</span>'). <span class="tactic">rewrite</span> <span class="id">P3</span> <span class="kwd">in</span> <span class="id">DISJ</span>. <span class="id">cbn</span> <span class="kwd">in</span> *. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>'); <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">EQ</span>, <span class="id">P3</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#heap_extensionality">heap_extensionality</a></span>; <span class="tactic">intros</span> <span class="id">l</span>'; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>'); <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="valid_N">valid_N</a></span> (<span class="id">l</span>: <span class="id"><a href="CDF.SepLogic.html#addr">addr</a></span>) (<span class="id">sz</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) : <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="CDF.SepLogic.html#sz">sz</a></span> <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#O">O</a></span> =&gt; <span class="id"><a href="CDF.SepLogic.html#emp">emp</a></span> | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">sz</span> =&gt; <span class="id"><a href="CDF.SepLogic.html#valid">valid</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> ** <span class="id"><a href="CDF.SepLogic.html#valid_N">valid_N</a></span> (<span class="id"><a href="CDF.SepLogic.html#l">l</a></span> + 1) <span class="id"><a href="CDF.SepLogic.html#sz">sz</a></span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="triple_alloc">triple_alloc</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">sz</span>,<br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#emp">emp</a></span> ]]<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#ALLOC">ALLOC</a></span> <span class="id"><a href="CDF.SepLogic.html#x">x</a></span> <span class="id"><a href="CDF.SepLogic.html#sz">sz</a></span><br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#aexists">aexists</a></span> (<span class="kwd">fun</span> <span class="id">l</span> =&gt; <span class="id"><a href="CDF.SepLogic.html#aequal">aequal</a></span> (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> <span class="id"><a href="CDF.SepLogic.html#x">x</a></span>) <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> //\\ <span class="id"><a href="CDF.SepLogic.html#valid_N">valid_N</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> <span class="id"><a href="CDF.SepLogic.html#sz">sz</a></span>) ]].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof184')">Proof.</div>
<div class="proofscript" id="proof184">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intros</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">EMP</span> &amp; <span class="id">R1</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>). <br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CDF.SepLogic.html#isfinite">isfinite</a></span> <span class="id">h</span>) <span class="kwd">as</span> (<span class="id">l0</span> &amp; <span class="id">FIN</span>). <br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">l</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.max">Z.max</a></span> <span class="id">l0</span> 1).<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Sequences.html#star_one">star_one</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#red_alloc">red_alloc</a></span> <span class="kwd">with</span> (<span class="id">l</span> := <span class="id">l</span>). <span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id">FIN</span>; <span class="id">lia</span>. <span class="id">lia</span>.<br/>
- <span class="id">exists</span> (<span class="id"><a href="CDF.SepLogic.html#hinit">hinit</a></span> <span class="id">l</span> <span class="id">sz</span> <span class="id"><a href="CDF.SepLogic.html#hempty">hempty</a></span>), <span class="id">h2</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">l</span>; <span class="tactic">split</span>. <span class="tactic">red</span>; <span class="id">cbn</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.IMP.html#update_same">update_same</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">REC</span>: <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">sz1</span> <span class="id">l1</span>, <span class="id"><a href="CDF.SepLogic.html#valid_N">valid_N</a></span> <span class="id"><a href="CDF.SepLogic.html#l1">l1</a></span> <span class="id"><a href="CDF.SepLogic.html#sz1">sz1</a></span> <span class="id"><a href="CDF.SepLogic.html#s1">s1</a></span> (<span class="id"><a href="CDF.SepLogic.html#hinit">hinit</a></span> <span class="id"><a href="CDF.SepLogic.html#l1">l1</a></span> <span class="id"><a href="CDF.SepLogic.html#sz1">sz1</a></span> <span class="id"><a href="CDF.SepLogic.html#hempty">hempty</a></span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">induction</span> <span class="id">sz1</span>; <span class="id">cbn</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exists</span> (<span class="id"><a href="CDF.SepLogic.html#hupdate">hupdate</a></span> <span class="id">l1</span> 0 <span class="id"><a href="CDF.SepLogic.html#hempty">hempty</a></span>), (<span class="id"><a href="CDF.SepLogic.html#hinit">hinit</a></span> (<span class="id">l1</span> + 1) <span class="id">sz1</span> <span class="id"><a href="CDF.SepLogic.html#hempty">hempty</a></span>); <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">exists</span> 0; <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="id">cbn</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l1</span> <span class="id">l2</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#hinit_outside">hinit_outside</a></span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#heap_extensionality">heap_extensionality</a></span>; <span class="tactic">intros</span>. <span class="id">cbn</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l1</span> <span class="id">l2</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">REC</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IND</span> <span class="kwd">with</span> <span class="id">s</span>; <span class="tactic">auto</span>. <span class="id">cbn</span>; <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.IMP.html#update_other">update_other</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">l</span>'. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.lt_ge_cases">Z.lt_ge_cases</a></span> <span class="id">l</span>' <span class="id">l</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#hinit_outside">hinit_outside</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">L</span>: <span class="id">h</span> <span class="id">l</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">FIN</span>; <span class="id">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">EQ</span> <span class="kwd">in</span> <span class="id">L</span>; <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">L</span>. <span class="tactic">destruct</span> (<span class="id">h1</span> <span class="id">l</span>'); <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">EQ</span>, <span class="id">EMP</span>, <span class="id"><a href="CDF.SepLogic.html#hunion_empty">hunion_empty</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#heap_extensionality">heap_extensionality</a></span>; <span class="tactic">intros</span> <span class="id">l</span>'; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.lt_ge_cases">Z.lt_ge_cases</a></span> <span class="id">l</span>' <span class="id">l</span>). <span class="tactic">rewrite</span> ! <span class="id"><a href="CDF.SepLogic.html#hinit_outside">hinit_outside</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.lt_ge_cases">Z.lt_ge_cases</a></span> <span class="id">l</span>' (<span class="id">l</span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> <span class="id">sz</span>)). <span class="tactic">rewrite</span> ! <span class="id"><a href="CDF.SepLogic.html#hinit_inside">hinit_inside</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> ! <span class="id"><a href="CDF.SepLogic.html#hinit_outside">hinit_outside</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">auto</span>. <br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="triple_free">triple_free</a></span>: <span class="kwd">forall</span> <span class="id">a</span> <span class="id">l</span>,<br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#aequal">aequal</a></span> <span class="id"><a href="CDF.SepLogic.html#a">a</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> //\\ <span class="id"><a href="CDF.SepLogic.html#valid">valid</a></span> <span class="id"><a href="CDF.SepLogic.html#l">l</a></span> ]]<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#FREE">FREE</a></span> <span class="id"><a href="CDF.SepLogic.html#a">a</a></span><br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#emp">emp</a></span> ]].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof185')">Proof.</div>
<div class="proofscript" id="proof185">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intros</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; (<span class="id">P1</span> &amp; <span class="id">P2</span>) &amp; <span class="id">R1</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>). <span class="tactic">destruct</span> <span class="id">P2</span> <span class="kwd">as</span> (<span class="id">v0</span> &amp; <span class="id">P2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Sequences.html#star_one">star_one</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#red_free">red_free</a></span> <span class="kwd">with</span> (<span class="id">l</span> := <span class="id">l</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">EQ</span>; <span class="id">cbn</span>. <span class="tactic">rewrite</span> ! <span class="id">P2</span>, <span class="id"><a href="CDF.SepLogic.html#hupdate_same">hupdate_same</a></span>. <span class="tactic">congruence</span>.<br/>
- <span class="id">exists</span> <span class="id"><a href="CDF.SepLogic.html#hempty">hempty</a></span>, <span class="id">h2</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;+ <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">EQ</span>, <span class="id">P2</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#heap_extensionality">heap_extensionality</a></span>; <span class="tactic">intros</span> <span class="id">l</span>'; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>'); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">l</span>'. <span class="tactic">generalize</span> (<span class="id">DISJ</span> <span class="id">l</span>). <span class="tactic">rewrite</span> <span class="id">P2</span>, <span class="id"><a href="CDF.SepLogic.html#hupdate_same">hupdate_same</a></span>. <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Les règles pour les autres constructions de IMP.  Elles sont proches
    de celles pour la logique de Hoare forte. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="triple_skip">triple_skip</a></span>:<br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#emp">emp</a></span> ]]  <span class="id"><a href="CDF.SepLogic.html#SKIP">SKIP</a></span>  [[ <span class="id"><a href="CDF.SepLogic.html#emp">emp</a></span> ]].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof186')">Proof.</div>
<div class="proofscript" id="proof186">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span> <span class="id">PRE</span>. <span class="id">exists</span> <span class="id">s</span>, <span class="id">h</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Sequences.html#star_refl">star_refl</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="triple_assign">triple_assign</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#aequal">aequal</a></span> <span class="id"><a href="CDF.SepLogic.html#a">a</a></span> <span class="id"><a href="CDF.SepLogic.html#n">n</a></span> //\\ <span class="id"><a href="CDF.SepLogic.html#emp">emp</a></span> ]]<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#ASSIGN">ASSIGN</a></span> <span class="id"><a href="CDF.SepLogic.html#x">x</a></span> <span class="id"><a href="CDF.SepLogic.html#a">a</a></span><br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#aequal">aequal</a></span> (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> <span class="id"><a href="CDF.SepLogic.html#x">x</a></span>) <span class="id"><a href="CDF.SepLogic.html#n">n</a></span> //\\ <span class="id"><a href="CDF.SepLogic.html#emp">emp</a></span> ]].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof187')">Proof.</div>
<div class="proofscript" id="proof187">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intros</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; (<span class="id">P1</span> &amp; <span class="id">P2</span>) &amp; <span class="id">R1</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>).<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Sequences.html#star_one">star_one</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#red_assign">red_assign</a></span>. <br/>
- <span class="id">exists</span> <span class="id">h1</span>, <span class="id">h2</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">red</span>; <span class="id">cbn</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CDF.IMP.html#update_same">update_same</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IND</span> <span class="kwd">with</span> <span class="id">s</span>; <span class="tactic">auto</span>. <span class="id">cbn</span>; <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.IMP.html#update_other">update_other</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="star_red_seq_step">star_red_seq_step</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c1</span> <span class="id">s1</span> <span class="id">h1</span> <span class="id">c2</span> <span class="id">s2</span> <span class="id">h2</span>, <span class="id"><a href="CDF.Sequences.html#star">star</a></span> <span class="tactic">red</span> (<span class="id"><a href="CDF.SepLogic.html#c1">c1</a></span>, <span class="id"><a href="CDF.SepLogic.html#s1">s1</a></span>, <span class="id"><a href="CDF.SepLogic.html#h1">h1</a></span>) (<span class="id"><a href="CDF.SepLogic.html#c2">c2</a></span>, <span class="id"><a href="CDF.SepLogic.html#s2">s2</a></span>, <span class="id"><a href="CDF.SepLogic.html#h2">h2</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span>, <span class="id"><a href="CDF.Sequences.html#star">star</a></span> <span class="tactic">red</span> (<span class="id"><a href="CDF.SepLogic.html#SEQ">SEQ</a></span> <span class="id"><a href="CDF.SepLogic.html#c1">c1</a></span> <span class="id"><a href="CDF.SepLogic.html#c">c</a></span>, <span class="id"><a href="CDF.SepLogic.html#s1">s1</a></span>, <span class="id"><a href="CDF.SepLogic.html#h1">h1</a></span>) (<span class="id"><a href="CDF.SepLogic.html#SEQ">SEQ</a></span> <span class="id"><a href="CDF.SepLogic.html#c2">c2</a></span> <span class="id"><a href="CDF.SepLogic.html#c">c</a></span>, <span class="id"><a href="CDF.SepLogic.html#s2">s2</a></span>, <span class="id"><a href="CDF.SepLogic.html#h2">h2</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof188')">Proof.</div>
<div class="proofscript" id="proof188">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">h2</span>; <span class="tactic">intros</span> <span class="id">STAR</span>; <span class="tactic">dependent</span> <span class="tactic">induction</span> <span class="id">STAR</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Sequences.html#star_refl">star_refl</a></span>.<br/>
- <span class="tactic">destruct</span> <span class="id">b</span> <span class="kwd">as</span> [ [<span class="id">c</span>' <span class="id">s</span>'] <span class="id">h</span>']. <span class="tactic">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_step">star_step</a></span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#red_seq_step">red_seq_step</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="triple_seq">triple_seq</a></span>: <span class="kwd">forall</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">R</span>,<br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> ]] <span class="id"><a href="CDF.SepLogic.html#c1">c1</a></span> [[ <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span> ]] -&gt; [[ <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span> ]] <span class="id"><a href="CDF.SepLogic.html#c2">c2</a></span> [[ <span class="id"><a href="CDF.SepLogic.html#R">R</a></span> ]] -&gt; [[ <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> ]] <span class="id"><a href="CDF.SepLogic.html#SEQ">SEQ</a></span> <span class="id"><a href="CDF.SepLogic.html#c1">c1</a></span> <span class="id"><a href="CDF.SepLogic.html#c2">c2</a></span> [[ <span class="id"><a href="CDF.SepLogic.html#R">R</a></span> ]].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof189')">Proof.</div>
<div class="proofscript" id="proof189">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intros</span> <span class="id">S</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span> <span class="id">A0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">IND1</span>: <span class="id"><a href="CDF.SepLogic.html#independent_of">independent_of</a></span> <span class="id">S</span> (<span class="id"><a href="CDF.SepLogic.html#modified_by">modified_by</a></span> <span class="id">c1</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">red</span>; <span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id">IND</span> <span class="kwd">with</span> <span class="id">s1</span>; <span class="tactic">auto</span>. <span class="id">cbn</span>. <span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id">H1</span>; <span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">IND2</span>: <span class="id"><a href="CDF.SepLogic.html#independent_of">independent_of</a></span> <span class="id">S</span> (<span class="id"><a href="CDF.SepLogic.html#modified_by">modified_by</a></span> <span class="id">c2</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">red</span>; <span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id">IND</span> <span class="kwd">with</span> <span class="id">s1</span>; <span class="tactic">auto</span>. <span class="id">cbn</span>. <span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id">H1</span>; <span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">H</span> <span class="id">S</span> <span class="id">IND1</span> <span class="id">s</span> <span class="id">h</span> <span class="id">A0</span>) <span class="kwd">as</span> (<span class="id">s1</span> &amp; <span class="id">h1</span> &amp; <span class="id">EXEC1</span> &amp; <span class="id">A1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">H0</span> <span class="id">S</span> <span class="id">IND2</span> <span class="id">s1</span> <span class="id">h1</span> <span class="id">A1</span>) <span class="kwd">as</span> (<span class="id">s2</span> &amp; <span class="id">h2</span> &amp; <span class="id">EXEC2</span> &amp; <span class="id">A2</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s2</span>, <span class="id">h2</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_trans">star_trans</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#star_red_seq_step">star_red_seq_step</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_step">star_step</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#red_seq_done">red_seq_done</a></span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="triple_ifthenelse">triple_ifthenelse</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">P</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#atrue">atrue</a></span>  <span class="id"><a href="CDF.SepLogic.html#b">b</a></span> //\\ <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> ]] <span class="id"><a href="CDF.SepLogic.html#c1">c1</a></span> [[ <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span> ]] -&gt;<br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#afalse">afalse</a></span> <span class="id"><a href="CDF.SepLogic.html#b">b</a></span> //\\ <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> ]] <span class="id"><a href="CDF.SepLogic.html#c2">c2</a></span> [[ <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span> ]] -&gt;<br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> ]] <span class="id"><a href="CDF.SepLogic.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id"><a href="CDF.SepLogic.html#b">b</a></span> <span class="id"><a href="CDF.SepLogic.html#c1">c1</a></span> <span class="id"><a href="CDF.SepLogic.html#c2">c2</a></span> [[ <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span> ]].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof190')">Proof.</div>
<div class="proofscript" id="proof190">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intros</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span> <span class="id">PRE</span>. <span class="tactic">destruct</span> (<span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span>) <span class="id">eqn</span>:<span class="id">B</span>.<br/>
- <span class="tactic">assert</span> (<span class="id">IND1</span>: <span class="id"><a href="CDF.SepLogic.html#independent_of">independent_of</a></span> <span class="id">R</span> (<span class="id"><a href="CDF.SepLogic.html#modified_by">modified_by</a></span> <span class="id">c1</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">IND</span> <span class="kwd">with</span> <span class="id">s1</span>; <span class="tactic">auto</span>. <span class="id">cbn</span>; <span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id">H1</span>; <span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">H</span> <span class="id">R</span> <span class="id">IND1</span> <span class="id">s</span> <span class="id">h</span>) <span class="kwd">as</span> (<span class="id">s</span>' &amp; <span class="id">h</span>' &amp; <span class="id">EXEC</span> &amp; <span class="id">POST</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CDF.SepLogic.html#lift_simple_conj">lift_simple_conj</a></span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s</span>', <span class="id">h</span>'; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_step">star_step</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#red_ifthenelse">red_ifthenelse</a></span>. <span class="tactic">rewrite</span> <span class="id">B</span>. <span class="tactic">auto</span>.<br/>
- <span class="tactic">assert</span> (<span class="id">IND2</span>: <span class="id"><a href="CDF.SepLogic.html#independent_of">independent_of</a></span> <span class="id">R</span> (<span class="id"><a href="CDF.SepLogic.html#modified_by">modified_by</a></span> <span class="id">c2</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">IND</span> <span class="kwd">with</span> <span class="id">s1</span>; <span class="tactic">auto</span>. <span class="id">cbn</span>; <span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id">H1</span>; <span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">H0</span> <span class="id">R</span> <span class="id">IND2</span> <span class="id">s</span> <span class="id">h</span>) <span class="kwd">as</span> (<span class="id">s</span>' &amp; <span class="id">h</span>' &amp; <span class="id">EXEC</span> &amp; <span class="id">POST</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CDF.SepLogic.html#lift_simple_conj">lift_simple_conj</a></span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s</span>', <span class="id">h</span>'; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_step">star_step</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#red_ifthenelse">red_ifthenelse</a></span>. <span class="tactic">rewrite</span> <span class="id">B</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="alessthan">alessthan</a></span> (<span class="id">a</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>) (<span class="id">v</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="CDF.SepLogic.html#simple_assertion">simple_assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> (<span class="id">s</span>: <span class="id"><a href="CDF.IMP.html#store">store</a></span>) =&gt; 0 &lt;= <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id"><a href="CDF.SepLogic.html#a">a</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span> &lt; <span class="id"><a href="CDF.SepLogic.html#v">v</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="triple_while">triple_while</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">variant</span> <span class="id">b</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#atrue">atrue</a></span> <span class="id"><a href="CDF.SepLogic.html#b">b</a></span> //\\ <span class="id"><a href="CDF.SepLogic.html#aequal">aequal</a></span> <span class="id"><a href="CDF.SepLogic.html#variant">variant</a></span> <span class="id"><a href="CDF.SepLogic.html#v">v</a></span> //\\ <span class="id"><a href="CDF.SepLogic.html#P">P</a></span>]]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#c">c</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#alessthan">alessthan</a></span> <span class="id"><a href="CDF.SepLogic.html#variant">variant</a></span> <span class="id"><a href="CDF.SepLogic.html#v">v</a></span> //\\ <span class="id"><a href="CDF.SepLogic.html#P">P</a></span>]])<br/>
&nbsp;&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> ]] <span class="id"><a href="CDF.SepLogic.html#WHILE">WHILE</a></span> <span class="id"><a href="CDF.SepLogic.html#b">b</a></span> <span class="id"><a href="CDF.SepLogic.html#c">c</a></span> [[ <span class="id"><a href="CDF.SepLogic.html#afalse">afalse</a></span> <span class="id"><a href="CDF.SepLogic.html#b">b</a></span> //\\ <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> ]].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof191')">Proof.</div>
<div class="proofscript" id="proof191">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">P</span> <span class="id">variant</span> <span class="id">b</span> <span class="id">c</span> <span class="id">TR</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">REC</span>: <span class="kwd">forall</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#aequal">aequal</a></span> <span class="id">variant</span> <span class="id"><a href="CDF.SepLogic.html#v">v</a></span> //\\ <span class="id">P</span> ]]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ]]).<br/>
&nbsp;&nbsp;{ <span class="tactic">induction</span> <span class="id">v</span> <span class="kwd">using</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Wf.html#well_founded_induction">well_founded_induction</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.lt_wf">Z.lt_wf</a></span> 0)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span> <span class="id">PRE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">IND1</span>: <span class="id"><a href="CDF.SepLogic.html#independent_of">independent_of</a></span> <span class="id">R</span> (<span class="id"><a href="CDF.SepLogic.html#modified_by">modified_by</a></span> <span class="id">c</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">red</span>; <span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id">IND</span> <span class="kwd">with</span> <span class="id">s1</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span>) <span class="id">eqn</span>:<span class="id">B</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">TR</span> <span class="id">v</span> <span class="id">R</span> <span class="id">IND1</span> <span class="id">s</span> <span class="id">h</span>) <span class="kwd">as</span> (<span class="id">s1</span> &amp; <span class="id">h1</span> &amp; <span class="id">EXEC1</span> &amp; <span class="id">POST1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CDF.SepLogic.html#lift_simple_conj">lift_simple_conj</a></span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CDF.SepLogic.html#lift_simple_conj">lift_simple_conj</a></span> <span class="kwd">in</span> <span class="id">POST1</span>. <span class="tactic">destruct</span> <span class="id">POST1</span> <span class="kwd">as</span> (<span class="id">LT</span> &amp; <span class="id">POST1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">H</span> (<span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">variant</span> <span class="id">s1</span>) <span class="id">LT</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s1</span> <span class="id">h1</span>) <span class="kwd">as</span> (<span class="id">s2</span> &amp; <span class="id">h2</span> &amp; <span class="id">EXEC2</span> &amp; <span class="id">POST2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CDF.SepLogic.html#lift_simple_conj">lift_simple_conj</a></span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s2</span>, <span class="id">h2</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_step">star_step</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#red_while_loop">red_while_loop</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_trans">star_trans</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#star_red_seq_step">star_red_seq_step</a></span>. <span class="id">eexact</span> <span class="id">EXEC1</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_step">star_step</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#red_seq_done">red_seq_done</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">EXEC2</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="CDF.SepLogic.html#lift_simple_conj">lift_simple_conj</a></span> <span class="kwd">in</span> <span class="id">PRE</span>. <span class="tactic">destruct</span> <span class="id">PRE</span> <span class="kwd">as</span> (<span class="id">EQ</span> &amp; <span class="id">POST1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s</span>, <span class="id">h</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CDF.Sequences.html#star_one">star_one</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#red_while_done">red_while_done</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="CDF.SepLogic.html#lift_simple_conj">lift_simple_conj</a></span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span> <span class="id">PRE</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">REC</span> (<span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">variant</span> <span class="id">s</span>) <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CDF.SepLogic.html#lift_simple_conj">lift_simple_conj</a></span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">La règle de conséquence. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="aimp">aimp</a></span> (<span class="id">P</span> <span class="id">Q</span>: <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">h</span>, <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span> <span class="id"><a href="CDF.SepLogic.html#h">h</a></span> -&gt; <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span> <span class="id"><a href="CDF.SepLogic.html#s">s</a></span> <span class="id"><a href="CDF.SepLogic.html#h">h</a></span>.<br/>
<br/>
<span class="kwd">Notation</span> "<span class="id">P</span> --&gt;&gt; <span class="id">Q</span>" := (<span class="id"><a href="CDF.SepLogic.html#aimp">aimp</a></span> <span class="id">P</span> <span class="id">Q</span>) (<span class="tactic">at</span> <span class="id">level</span> 95, <span class="id">no</span> <span class="id">associativity</span>).<br/>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="aimp_sepconj">aimp_sepconj</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">P</span>' <span class="id">Q</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#P">P</a></span> --&gt;&gt; <span class="id">P</span>' -&gt; <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> ** <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span> --&gt;&gt; <span class="id">P</span>' ** <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof192')">Proof.</div>
<div class="proofscript" id="proof192">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>. <span class="tactic">intros</span> <span class="id">s</span> <span class="id">h</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">P1</span> &amp; <span class="id">Q2</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>). <span class="id">exists</span> <span class="id">h1</span>, <span class="id">h2</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="triple_consequence">triple_consequence</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">P</span>' <span class="id">c</span> <span class="id">Q</span>' <span class="id">Q</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#P">P</a></span> --&gt;&gt; <span class="id">P</span>'  -&gt;  [[ <span class="id">P</span>' ]] <span class="id"><a href="CDF.SepLogic.html#c">c</a></span> [[ <span class="id">Q</span>' ]]  -&gt;  <span class="id">Q</span>' --&gt;&gt; <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span>  -&gt;<br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#P">P</a></span> ]] <span class="id"><a href="CDF.SepLogic.html#c">c</a></span> [[ <span class="id"><a href="CDF.SepLogic.html#Q">Q</a></span> ]].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof193')">Proof.</div>
<div class="proofscript" id="proof193">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intros</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span> <span class="id">PRE</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">H0</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span>) <span class="kwd">as</span> (<span class="id">s</span>' &amp; <span class="id">h</span>' &amp; <span class="id">EXEC</span> &amp; <span class="id">POST</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#aimp_sepconj">aimp_sepconj</a></span> <span class="kwd">with</span> <span class="id">P</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s</span>', <span class="id">h</span>'; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.SepLogic.html#aimp_sepconj">aimp_sepconj</a></span> <span class="kwd">with</span> <span class="id">Q</span>'; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
